<!DOCTYPE html>
<html>
    <head>
        <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #controls { position: absolute; top: 10px; left: 10px; color: white; }
        #toolbars {position: absolute; top: 10px; right: 20px;}
        #editBars {position: absolute; top: 10px; right: 20px; display: none;}
        #returnButton { position: absolute; top: 10px; left: 10px; }
        #doneButton { position: absolute; top: 10px; left: 10px; display: none;}
        #displayInfoMenu button { 
            margin-bottom: 25px;
            width: 200px;
            height: 40px;
            text-align: center;
            padding-left: 10px;
            font-size: 16px;
        }
        #displayTab {
            position: absolute;
            top: 0;
            right: 0;
            width: 40%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none; /* Initially hidden */
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            z-index: 1000; /* Make sure it appears above other content */
        }
        .buttonContainer {
            display: flex;
            justify-content: space-between;
        }
        .buttonContainer button {
            width: 100px;
            cursor: pointer;
        }
        #chartContainer {
            width: 100%;  /* 设置容器宽度 */
            height: 100%; /* 设置容器高度 */
            position: relative;
        }
        .chart {
            width: 100%;  /* 设置每个图表容器的宽度 */
            height: 100%; /* 设置每个图表容器的高度 */
            display: none; /* 默认隐藏 */
        }
        .lowerSection {
            display: none;
            position: relative;
            top: -10px;
            color: white; 
            height: 68%; 
            width: 100%;
        }
        #menu button { 
            margin-bottom: 25px;
            width: 200px; 
            height: 40px; 
            text-align: center;
            padding-left: 10px;
            font-size: 16px;
            }
        #toolbars button {
            display: inline;
            margin-left: 10px;
            width: 150px;
            height: 20px;
            text-align: center;
            font-size: 10px;
        }
        #editBars button {
            display: inline;
            margin-left: 20px;
            width: 150px;
            height: 20px;
            text-align: center;
            font-size: 10px;
        }
        #editTab {
            position: absolute;
            top: 0;
            right: 0;
            width: 30%; 
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            z-index: 1000;
            color: white;
        }
        .editPanel {
                display: none;
                position: relative;
                top: 0px;
                color: white; 
                height: 100%; 
                width: 100%;
        }
        /* Applies block display and margin to all labels within .editPanel */
        .editPanel label {
            display: block;
            padding-left: 10px;
            margin-bottom: 5px;
            margin-top: 5px;
        }

        /* Keeps labels inside .radio-group inline */
        .radio-group label {
            display: inline;
            margin-right: 10px; /* Adjust spacing between "Yes" and "No" */
        }

        .radio-group {
            display: inline-flex;
            align-items: center;
            margin-bottom: 5px;
        }
        </style>
    </head>
    <body>
        <div id="controls">
            <label>Camera Angle: <input type="range" id="angleSlider" min="0" max="360" value="0"></label><br>
            <label>Zoom: <input type="range" id="zoomSlider" min="10" max="50" value="20"></label>
        </div>
        <div id="toolbars">
            <button id="galaxyButton" onclick="window.location.href='galaxy.html'">Galaxy Showcase</button>
            <button id="editButton">Customize</button>
        </div>
        <div id="editBars">
            <button id="planetButton">Create Planet</button>
            <button id="displayButton">Display</button>
        </div>
        <button id="returnButton" style="display: none;">Return</button>
        <button id="doneButton">Done</button>
        
        <div id="displayInfoMenu" style="display: none; position: absolute; top: 20%; left: 10px; color: white;">
            <button onclick="showInfo(1)">Basic Physical Properties</button><br>
            <button onclick="showInfo(2)">Gravitational and Dynamic</button><br>
            <button onclick="showInfo(3)">Rotation and Tilt</button><br>
            <button onclick="showInfo(4)">Satellite and Ring System</button><br>
            <button onclick="showInfo(5)">Temperature and Atmospheric</button><br>
            <button onclick="showInfo(6)">Orbit Properties</button><br>
        </div>
        <div id="displayTab">
            <div id="upperSection" style="position: relative; top: -20px; color: white; height: 30%; width: 100%;"></div>
            <div id="lower1" class="lowerSection">
                <div id="buttonCon1" class="buttonContainer">
                    <button onclick="chart(1)" class="tabButton">Mass</button>
                    <button onclick="chart(2)" class="tabButton">Diameter</button>
                    <button onclick="chart(3)" class="tabButton">Density</button>
                </div>
                <div id="chartCon1" class="chartContainer">
                    <div id="chart1" class="chart"></div>
                    <div id="chart2" class="chart"></div>
                    <div id="chart3" class="chart"></div>
                </div>
            </div>
            <div id="lower2" class="lowerSection">
                <div id="buttonCon2" class="buttonContainer">
                    <button onclick="chart(4)" class="tabButton">Surface Gravity</button>
                    <button onclick="chart(5)" class="tabButton">Escape Velocity</button>
                </div>
                <div id="chartCon2" class="chartContainer">
                    <div id="chart4" class="chart"></div>
                    <div id="chart5" class="chart"></div>
                </div>
            </div>
            <div id="lower3" class="lowerSection">
                <div id="buttonCon3" class="buttonContainer">
                    <button onclick="chart(6)" class="tabButton">Rotation Period</button>
                    <button onclick="chart(7)" class="tabButton">Obliquity</button>
                </div>
                <div id="chartCon3" class="chartContainer">
                    <div id="chart6" class="chart"></div>
                    <div id="chart7" class="chart"></div>
                </div>
            </div>
            <div id="lower4" class="lowerSection">
                <div id="buttonCon4" class="buttonContainer">
                    <button onclick="chart(8)" class="tabButton">Number of Moons</button>
                    <button onclick="chart(9)" class="tabButton">Ring?</button>
                </div>
                <div id="chartCon4" class="chartContainer">
                    <div id="chart8" class="chart"></div>
                    <div id="chart9" class="chart"></div>
                </div>
            </div>
            <div id="lower5" class="lowerSection">
                <div id="buttonCon5" class="buttonContainer">
                    <button onclick="chart(10)" class="tabButton">Mean Temperature</button>
                    <button onclick="chart(11)" class="tabButton">Atmosphere Composition</button>
                </div>
                <div id="chartCon5" class="chartContainer">
                    <div id="chart10" class="chart"></div>
                    <div id="chart11" class="chart"></div>
                </div>
            </div>
            <div id="lower6" class="lowerSection">
                <div id="buttonCon6" class="buttonContainer">
                    <button onclick="chart(12)" class="tabButton">Period</button>
                    <button onclick="chart(13)" class="tabButton">Velocity</button>
                    <button onclick="chart(14)" class="tabButton">Inclination</button>
                    <button onclick="chart(15)" class="tabButton">Eccentricity</button>
                </div>
                <div id="chartCon6" class="chartContainer">
                    <div id="chart12" class="chart"></div>
                    <div id="chart13" class="chart"></div>
                    <div id="chart14" class="chart"></div>
                    <div id="chart15" class="chart"></div>
                </div>
            </div>
        </div>

        <div id="menu" style="display: none; position: absolute; top: 20%; left: 10px;">
            <button onclick="edit(1)">Planet</button><br>
            <button onclick="edit(2)">Moon & Ring</button><br>
            <button onclick="edit(3)">Atmosphere</button><br>
            <button onclick="edit(4)">Orbit</button><br>
        </div>
        <div id="editTab">
            <div id="editPlanet" class="editPanel">
                <h3>Planet Appearance</h3>
                <label>Planet Name: <input type="text" id="planetName" placeholder="Enter planet name"></label><br>
                
                <!-- Texture Upload -->
                <label>Upload Planet Texture: <input type="file" id="textureUploader" accept="image/*"></label><br>
        
                <!-- Size Adjustment -->
                <label>Planet Size: 
                    <input type="range" id="sizeSlider" min="0.1" max="5" value="0.5" step="0.1">
                    <span id="sizeValue">0.5</span>
                </label><br>

                <!-- Rotation Period -->
                <label>Rotation Period: 
                    <input type="range" id="rotationPeriodSlider" min="1" max="5000" value="1">
                    <span id="rotationPeriodValue">1</span> hours
                </label><br>
        
                <!-- Obliquity -->
                <label>Obliquity: 
                    <input type="range" id="obliquitySlider" min="0" max="90" value="10">
                    <span id="obliquityValue">10</span>º
                </label><br>
        
                <h3>Physical Properties</h3>            
                <!-- Mass Adjustment -->
                <label>Planet Mass: 
                    <input type="range" id="massSlider" min="0.1" max="2000" value="50">
                    <span id="massValue">50</span> x10²⁴kg
                </label><br>

                <!-- Diameter Adjustment -->
                <label>Planet Diameter: 
                    <input type="range" id="diameterSlider" min="4500" max="150000" value="20000" step="100">
                    <span id="diameterValue">20000</span> km
                </label><br>
        
                <!-- Density Adjustment -->
                <label>Planet Density: 
                    <input type="range" id="densitySlider" min="650" max="5600" value="700">
                    <span id="densityValue">700</span> kg/m³
                </label><br>
        
                <!-- Surface Gravity -->
                <label>Surface Gravity: 
                    <input type="range" id="gravitySlider" min="0" max="100" value="10">
                    <span id="gravityValue">10</span> m/s²
                </label><br>
        
                <!-- Escape Velocity -->
                <label>Escape Velocity: 
                    <input type="range" id="escapeVelocitySlider" min="0" max="100" value="25">
                    <span id="escapeVelocityValue">25</span> km/s
                </label><br>            
            </div>
            <div id="editRing" class="editPanel">
                <h3>Moons</h3>
                <!-- Number of Moons -->
                <label>Number of Moon:
                    <input type="range" id="moonSlider" min="0" max="100" value="1">
                    <span id="moonValue">1</span>
                </label><br>

                <h3>Ring System</h3>
                <label>Add Ring?</label>
                <div class="radio-group">
                    <label for="ringYes">Yes</label>
                    <input type="radio" id="ringYes" name="ringOption" value="yes">
                    <label for="ringNo">No</label>
                    <input type="radio" id="ringNo" name="ringOption" value="no" checked>                    
                </div>      
            
                <!-- 颜色选择器，默认隐藏 -->
                <div id="colourPicker" style="margin-top: 10px;">
                    <label for="ringColour">Ring Colour:
                    <input type="colour" id="ringColour" value="#ff9900"></label> <!-- 默认颜色 -->
                </div>
                <label>Opacity: 
                    <input type="range" id="opacitySlider" min="0" max="1" value="0.7" step="0.1">
                    <span id="opacityValue">0.7</span>
                </label><br>
                <label>Tilt: 
                    <input type="range" id="tiltSlider" min="0" max="90" value="25">
                    <span id="tiltValue">25</span>º
                </label><br>
            </div>
            <div id="editAtmosphere" class="editPanel">
                <h3>Atmosphere Composition</h3>
                <label>H₂: 
                    <input type="range" id="hydrogenSlider" min="0" max="100" value="0">
                    <span id="hydrogenValue">0</span> %
                </label><br>
                <label>He: 
                    <input type="range" id="heliumSlider" min="0" max="100" value="0">
                    <span id="heliumValue">0</span> %
                </label><br>
                <label>N₂: 
                    <input type="range" id="nitrogenSlider" min="0" max="100" value="0">
                    <span id="nitrogenValue">0</span> %
                </label><br>
                <label>CO₂: 
                    <input type="range" id="carbonSlider" min="0" max="100" value="0">
                    <span id="carbonValue">0</span> %
                </label><br>
                <label>O₂: 
                    <input type="range" id="oxygenSlider" min="0" max="100" value="0">
                    <span id="oxygenValue">0</span> %
                </label><br>
                <label>Na: 
                    <input type="range" id="sodiumSlider" min="0" max="100" value="0">
                    <span id="sodiumValue">0</span> %
                </label><br>
                <label>Ar: 
                    <input type="range" id="argonSlider" min="0" max="100" value="0">
                    <span id="argonValue">0</span> %
                </label><br>
                <label>CH₄: 
                    <input type="range" id="methaneSlider" min="0" max="100" value="0">
                    <span id="methaneValue">0</span> %
                </label><br>
                <label>Other: 
                    <input type="range" id="otherSlider" min="0" max="100" value="0">
                    <span id="otherValue">0</span> %
                </label><br>
                <h3>Temperature</h3>
                <label>Mean Temperature: 
                    <input type="range" id="tempSlider" min="-273" max="273" value="25">
                    <span id="tempValue">25</span> °C
                </label><br>
            </div>
            <div id="editOrbit" class="editPanel">
                <h3>Orbit Appearance</h3>
                <!-- Orbit Radius -->
                <label>Orbit Radius: 
                    <input type="range" id="orbitRadiusSlider" min="5" max="40" value="10">
                    <span id="orbitRadiusValue">10</span>
                </label><br>
            <!-- Orbit Velocity -->
                <label>Orbit Velocity: 
                    <input type="range" id="orbitVelocitySlider" min="5" max="100" value="25">
                    <span id="orbitVelocityValue">25</span> km/s
                </label><br>
                <!-- Orbit Inclination -->
                <label>Orbit Inclination: 
                    <input type="range" id="orbitInclinationSlider" min="0" max="90" value="90" step="0.5">
                    <span id="orbitInclinationValue">90</span>º            
                </label><br>
                <h3>Orbit Properties</h3>
                <!-- Orbit Period -->
                <label>Orbit Period: 
                    <input type="range" id="orbitPeriodSlider" min="1" max="60000" value="300" step="1">
                    <span id="orbitPeriodValue">300</span> days
                </label><br>
                <!-- Orbit Eccentricity -->
                <label>Orbit Eccentricity: 
                    <input type="range" id="eccentricitySlider" min="0" max="1" value="0.0156" step="0.0001">
                    <span id="eccentricityValue">0.0156</span>
                </label><br>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script>
            let scene, camera, renderer, sun;
            let selectedPlanet = null;
            const planets = [];

            function createScene() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                const textureLoader = new THREE.TextureLoader();
                textureLoader.load('cosmos.jpg', function(texture) {
                    scene.background = texture;
                });

                const sunGeometry = new THREE.SphereGeometry(4, 32, 32);
                textureLoader.load('sun_texture.jpg', function(texture) {
                    const sunMaterial = new THREE.MeshBasicMaterial({ map: texture });
                    sun = new THREE.Mesh(sunGeometry, sunMaterial);
                    scene.add(sun);
                });

                // Camera Setups
                camera.position.set(0, 15, 20);
                camera.lookAt(scene.position);

                let angleSlider = document.getElementById("angleSlider");
                let zoomSlider = document.getElementById("zoomSlider");

                angleSlider.addEventListener("input", updateCamera);
                zoomSlider.addEventListener("input", updateCamera);

                function updateCamera() {
                    let angle = angleSlider.value * Math.PI / 180;
                    let distance = zoomSlider.value;

                    camera.position.x = distance * Math.sin(angle);
                    camera.position.z = distance * Math.cos(angle);
                    camera.lookAt(scene.position);
                };
                

                window.addEventListener('resize', function() {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });

                // Add Raycaster for detecting clicks on planets
                let raycaster = new THREE.Raycaster();
                let mouse = new THREE.Vector2();
                let selectedPlanet = null; // Current selected planet
                let originalCameraPosition = camera.position.clone(); // Save original camera position
                let originalCameraLookAt = new THREE.Vector3(0, 0, 0); // Original camera look-at point
                function onMouseClick(event) {
                    //event.preventDefault();
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
                    raycaster.setFromCamera(mouse, camera);

                    let planetMeshes = planets.map(planet => planet.renderParams.mesh);
                    let intersects = raycaster.intersectObjects(planetMeshes);

                    if (intersects.length > 0) {
                        let clickedMesh = intersects[0].object;
                        let clickedPlanet = planets.find(planet => planet.renderParams.mesh === clickedMesh);
                        if (clickedPlanet) {
                            focusOnPlanet(clickedPlanet);
                        }
                    }
                };

                // Function to handle return button click
                function handleReturnButtonClick() {
                    console.log("Return button clicked"); // 调试输出

                    planetClickedEnabled = true;

                    // 恢复相机位置
                    camera.position.copy(originalCameraPosition);
                    camera.lookAt(originalCameraLookAt);

                    // 清除选中的行星
                    selectedPlanet = null;

                    // 恢复整个星球系统的UI
                    document.getElementById('controls').style.display = 'block';
                    document.getElementById('planetButton').style.display = 'block';
                    document.getElementById('displayButton').style.display = 'block';
                    document.getElementById('displayInfoMenu').style.display = 'none';
                    document.getElementById('displayTab').style.display = 'none';
                    document.getElementById('returnButton').style.display = 'none';
                    var lowers = document.querySelectorAll(".lowerSection");
                    lowers.forEach(function(lower) {
                        lower.style.display = "none"; // Hide all lower sections first
                    });
                };

                let planetClickedEnabled = true;
                let editMode = false;

                window.focusOnPlanet = function(planetObject) {
                    if (!planetClickedEnabled) return;
                    
                    if (!planetObject) {
                        console.error('No planet object passed.');
                        return;
                    }
                    selectedPlanet = planetObject;

                    // Save current camera position
                    originalCameraPosition.copy(camera.position);
                    originalCameraLookAt.copy(scene.position);

                    // Adjust camera position, make it focus on the selected planet
                    const offset = 5; // Adjust distance between camera and planet
                    camera.position.set(
                        selectedPlanet.renderParams.mesh.position.x + offset, 
                        selectedPlanet.renderParams.mesh.position.y + offset, 
                        selectedPlanet.renderParams.mesh.position.z + offset
                    );
                    camera.lookAt(selectedPlanet.renderParams.mesh.position);

                    if (editMode) {
                        document.getElementById('controls').style.display = 'none';
                        document.getElementById('editTab').style.display = 'block';
                        document.getElementById('menu').style.display = 'block';
                        document.getElementById('editBars').style.display = 'none';
                        document.getElementById('doneButton').style.display = 'block';

                        planetClickedEnabled = false;

                        if (!selectedPlanet.fresh) {
                            redoPlanet(selectedPlanet)
                        }
                    } else {
                        document.getElementById('displayInfoMenu').style.display = 'block';
                        document.getElementById('displayTab').style.display = 'block';
                        document.getElementById('returnButton').style.display = 'block';
                        document.getElementById('controls').style.display = 'none';
                        document.getElementById('planetButton').style.display = 'none';
                        document.getElementById('displayButton').style.display = 'block';

                        planetClickedEnabled = false;

                        // Display the information about the selected planet (optional)
                        //displayPlanetInfo(planetName, 1); // Default to Basic Physical Properties

                        // Only bind the return button click handler once
                        document.getElementById('returnButton').removeEventListener('click', handleReturnButtonClick); // 清除以前的监听
                        document.getElementById('returnButton').addEventListener('click', handleReturnButtonClick);
                    }
                };

                // Add event listener for mouse clicks
                window.addEventListener('click', onMouseClick, false);

                window.renderMassChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetMasses = planets.map(planet => planet.dataParams.mass);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetMasses,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetMasses.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Mass of Planets (in 10²⁴ kg)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Mass (10²⁴ kg)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart1', [trace], layout);
                };

                window.renderDiameterChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetDiameters = planets.map(planet => planet.dataParams.diameter);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetDiameters,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetDiameters.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Diameter of Planets (in km)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Diameter (km)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart2', [trace], layout);
                };
                
                window.renderDensityChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetDensities = planets.map(planet => planet.dataParams.density);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetDensities,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetDensities.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Density of Planets (in kg/m³)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Density (kg/m³)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart3', [trace], layout);
                };

                window.renderGravityChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetGravities = planets.map(planet => planet.dataParams.gravity);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetGravities,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetGravities.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Surface Gravity of Planets (in m/s²)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Surface Gravity (m/s²)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart4', [trace], layout);
                };

                window.renderEscapeVelocityChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetEscapeVelocities = planets.map(planet => planet.dataParams.escapeVelocity);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetEscapeVelocities,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetEscapeVelocities.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Escape Velocity of Planets (in km/s)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Escape Velocity (km/s)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart5', [trace], layout);
                };
                
                window.renderRotationPeriodChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetRotationPeriods = planets.map(planet => planet.dataParams.rotationPeriod);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetRotationPeriods,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetRotationPeriods.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Rotation Period of Planets (in hours)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Rotation Period (hours)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart6', [trace], layout);
                };
                    
                window.renderObliquityChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetObliquities = planets.map(planet => planet.dataParams.obliquity);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetObliquities,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetObliquities.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Obliquity to Orbit of Planets (in degrees)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Obliquity to Orbit (degrees)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart7', [trace], layout);
                };
                    
                window.renderMoonChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetMoons = planets.map(planet => planet.dataParams.moon);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetMoons,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetMoons.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Number of Moons for Each Planet',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Number of Moons'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart8', [trace], layout);
                };

                window.renderRingChart = function() {
                    const ringCounts = { 'With Ring System': 0, 'Without Ring System': 0 };
                    planets.forEach(planet => {
                        const ringStatus = planet.renderParams.ring ? 'With Ring System' : 'Without Ring System';
                        ringCounts[ringStatus] += 1;
                    });

                    let labels = Object.keys(ringCounts);
                    let values = Object.values(ringCounts);

                    let trace = {
                        values: values,
                        labels: labels,
                        type: 'pie',
                        textinfo: 'label+percent',
                        insidetextorientation: 'radial',
                        marker: {
                            colors: ['#FF5733', '#4B8EF1']    
                        }
                     };

                     let layout = {
                         title: 'Planets with Ring Systems',
                         plot_bgcolor: 'rgba(0,0,0,0)',
                         paper_bgcolor: 'rgba(0,0,0,0)',
                         font: { color: 'white' },
                         width: 550,  
                         height: 420
                     };
                     Plotly.newPlot('chart9', [trace], layout);
                   };                    

                window.renderTemperatureChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetTemps = planets.map(planet => planet.dataParams.temp);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetTemps,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetTemps.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Mean Temperature of Planets (ºC)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Mean Temperature (ºC)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart10', [trace], layout);
                };
            
                window.renderAtmosphereChart = function(selectedPlanet) {
                    if (!selectedPlanet || !selectedPlanet.atmosphere) {
                        alert("No atmospheric composition data available for the selected planet.");
                        return;
                    }
                    const atmosphereData = selectedPlanet.atmosphere;
                    let gasNames = Object.keys(atmosphereData);
                    let gasValues = Object.values(atmosphereData);

                    let trace = {
                         values: gasValues,
                         labels: gasNames,
                         type: 'pie',
                         textinfo: 'label+percent',
                         insidetextorientation: 'radial',
                         marker: {
                             colors: ['#FF5733', '#4B8EF1', '#FFC300', '#DAF7A6', '#581845', '#C70039', '#900C3F', '#FF5733', '#FFC300']
                        }
                     };

                     let layout = {
                         title: 'Atmospheric Composition of ' + selectedPlanet.name,
                         plot_bgcolor: 'rgba(0,0,0,0)',
                         paper_bgcolor: 'rgba(0,0,0,0)',
                         font: { color: 'white' },
                         width: 550,  
                         height: 420
                      };
                      Plotly.newPlot('chart11', [trace], layout);
                     };

                window.renderOrbitalPeriodChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetOrbitalPeriods = planets.map(planet => planet.dataParams.orbitPeriod);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetOrbitalPeriods,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetOrbitalPeriods.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Orbital Period of Planets (in days)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Orbital Period (days)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart12', [trace], layout);
                };

                window.renderOrbitalVelocityChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetOrbitalVelocities = planets.map(planet => planet.renderParams.orbitVelocity);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetOrbitalVelocities,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetOrbitalVelocities.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Orbital Velocity of Planets (in km/s)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Orbital Velocity (km/s)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart13', [trace], layout);
                };

                window.renderOrbitalInclinationChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetOrbitalInclinations = planets.map(planet => planet.dataParams.orbitInclination);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetOrbitalInclinations,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetOrbitalInclinations.map(String),
                        textposition: 'outside'
                    };
                        let layout = {
                        title: 'Orbital Inclination of Planets (in degrees)',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Orbital Inclination (degrees)'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                            width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart14', [trace], layout);
                };

                window.renderOrbitalEccentricityChart = function(selectedPlanet) {
                    let planetNames = planets.map(planet => planet.name);
                    let planetEccentricities = planets.map(planet => planet.dataParams.eccentricity);
                    let colors = planets.map(planet => planet.name === selectedPlanet.name ? '#FF5733' : '#4B8EF1');

                    let trace = {
                        x: planetNames,
                        y: planetEccentricities,
                        type: 'bar',
                        marker: {color: colors},
                        text: planetEccentricities.map(String),
                        textposition: 'outside'
                    };
                    let layout = {
                        title: 'Orbital Eccentricity of Planets',
                        xaxis: {title: 'Planet'},
                        yaxis: {title: 'Eccentricity'},
                        plot_bgcolor: 'rgba(0,0,0,0)',
                        paper_bgcolor: 'rgba(0,0,0,0)',
                        font: {color: 'white'},
                        width: 550,  
                        height: 420
                    };
                    Plotly.newPlot('chart15', [trace], layout);
                };

                // The toggleChart function now accepts a button number as an argument
                window.toggleChart = function(selectedPlanet,chartId) {
                    const charts = document.querySelectorAll(".chart");
                    charts.forEach(function(chart) {
                        chart.style.display = "none"; // Hide all charts first
                    });

                    let chartElement = document.getElementById(chartId);
                    chartElement.style.display = "block";

                    if (chartId === "chart1") {
                        renderMassChart(selectedPlanet);
                    } else if (chartId === "chart2") {
                        renderDiameterChart(selectedPlanet);
                    } else if (chartId === "chart3") {
                        renderDensityChart(selectedPlanet);
                    } else if (chartId === "chart4") {
                        renderGravityChart(selectedPlanet);
                    } else if (chartId === "chart5") {
                        renderEscapeVelocityChart(selectedPlanet);
                    } else if (chartId === "chart6") {
                        renderRotationPeriodChart(selectedPlanet);
                    } else if (chartId === "chart7") {
                        renderObliquityChart(selectedPlanet);
                    } else if (chartId === "chart8") {
                        renderMoonChart(selectedPlanet);
                    } else if (chartId === "chart9") {
                        renderRingChart(selectedPlanet);
                    } else if (chartId === "chart10") {
                        renderTemperatureChart(selectedPlanet);
                    } else if (chartId === "chart11") {
                        renderAtmosphereChart(selectedPlanet);
                    } else if (chartId === "chart12") {
                        renderOrbitalPeriodChart(selectedPlanet);
                    } else if (chartId === "chart13") {
                        renderOrbitalVelocityChart(selectedPlanet);
                    } else if (chartId === "chart14") {
                        renderOrbitalInclinationChart(selectedPlanet);
                    } else if (chartId === "chart15") {
                        renderOrbitalEccentricityChart(selectedPlanet);
                    }
                };

                // Function to display the appropriate chart based on button
                window.displayChart = function(selectedPlanet,buttonNumber) {
                    switch (buttonNumber) {
                        case 1:
                            toggleChart(selectedPlanet,"chart1");
                            break;
                        case 2:
                            toggleChart(selectedPlanet,"chart2");
                            break;
                        case 3:
                            toggleChart(selectedPlanet,"chart3");
                            break;
                        case 4:
                            toggleChart(selectedPlanet,"chart4");
                            break;
                        case 5:
                            toggleChart(selectedPlanet,"chart5");
                            break;
                        case 6:
                            toggleChart(selectedPlanet,"chart6");
                            break;
                        case 7:
                            toggleChart(selectedPlanet,"chart7");
                            break;
                        case 8:
                            toggleChart(selectedPlanet,"chart8");
                            break;
                        case 9:
                            toggleChart(selectedPlanet,"chart9");
                            break;
                        case 10:
                            toggleChart(selectedPlanet,"chart10");
                            break;
                        case 11:
                            toggleChart(selectedPlanet,"chart11");
                            break;
                        case 12:
                            toggleChart(selectedPlanet,"chart12");
                            break;
                        case 13:
                            toggleChart(selectedPlanet,"chart13");
                            break;
                        case 14:
                            toggleChart(selectedPlanet,"chart14");
                            break;
                        case 15:
                            toggleChart(selectedPlanet,"chart15");
                            break;
                        default:
                            console.log("Unable to toggle chart");
                    }
                };

                // Function triggered by button clicks to show specific chart
                window.chart = function(chartType) {
                    if (selectedPlanet) {
                        displayChart(selectedPlanet, chartType);
                    } else {
                        alert("No planet selected");
                    }
                };

                // Function to display specific information based on infoType
                window.displayPlanetInfo = function(selectedPlanet, infoType) {
                    const upperSection = document.getElementById('upperSection');
                    let lowers = document.querySelectorAll(".lowerSection");
                    lowers.forEach(function(lower) {
                        lower.style.display = "none"; // Hide all lower sections first
                    });

                    // Display different information based on the infoType
                    switch (infoType) {
                            case 1: // Basic Physical Properties
                                upperSection.innerHTML = `
                                    <h1>${selectedPlanet.name}</h1>
                                    <p>Mass: ${selectedPlanet.dataParams.mass} x 10²⁴ kg</p>
                                    <p>Diameter: ${selectedPlanet.dataParams.diameter} km</p>
                                    <p>Density: ${selectedPlanet.dataParams.density} kg/m³</p>
                                `;
                                document.getElementById('lower1').style.display = 'block';
                                displayChart(selectedPlanet,1);
                                break;
                            case 2: // Gravitational and Dynamic Properties
                                upperSection.innerHTML = `
                                    <h1>${selectedPlanet.name}</h1>
                                    <p>Surface Gravity: ${selectedPlanet.dataParams.gravity} m/s²</p>
                                    <p>Escape Velocity: ${selectedPlanet.dataParams.escapeVelocity} km/s</p>
                                `;
                                document.getElementById('lower2').style.display = 'block';
                                displayChart(selectedPlanet,4)
                                break;
                                
                            case 3: // Rotation and Tilt
                                upperSection.innerHTML = `
                                    <h1>${selectedPlanet.name}</h1>
                                    <p>Rotation Period: ${selectedPlanet.dataParams.rotationPeriod} hours</p>
                                    <p>Obliquity: ${selectedPlanet.dataParams.obliquity} º</p>
                                `;
                                document.getElementById('lower3').style.display = 'block';
                                displayChart(selectedPlanet,6)
                                break;
                            case 4: // Satellite and Ring System
                                upperSection.innerHTML = `
                                    <h1>${selectedPlanet.name}</h1>
                                    <p>Number of Moons: ${selectedPlanet.dataParams.moon}</p>
                                    <p>Ring System: ${selectedPlanet.renderParams.ring}</p>
                                `;
                                document.getElementById('lower4').style.display = 'block';
                                displayChart(selectedPlanet,8)
                                break;
                            case 5: // Temperature and Atmospheric Conditions
                                upperSection.innerHTML = `
                                    <h1>${selectedPlanet.name}</h1>
                                    <p>Mean Temperature: ${selectedPlanet.dataParams.temp} °C</p>
                                    <p>Atmosphere: ${formatAtmosphere(selectedPlanet.atmosphere)}</p>
                                `;
                                document.getElementById('lower5').style.display = 'block';
                                displayChart(selectedPlanet, 10);
                                break;
                            case 6: // Orbit Propertie
                                upperSection.innerHTML = `
                                    <h1>${selectedPlanet.name}</h1>
                                    <p>Orbital Period: ${selectedPlanet.dataParams.orbitalPeriods} days</p>
                                    <p>Orbital Velocity: ${selectedPlanet.renderParams.orbitVelocity} km/s</p>
                                    <p>Orbital Inclination: ${selectedPlanet.dataParams.orbitInclination} º</p>
                                    <p>Orbital Eccentricity: ${selectedPlanet.dataParams.eccentricity}</p>
                                `;
                                document.getElementById('lower6').style.display = 'block';
                                displayChart(selectedPlanet,12)
                                break;
                            default:
                                upperSection.innerHTML = `<p>No data available for ${selectedPlanet.name}</p>`;
                                lowerSection.innerHTML = '';
                        }
                };

                function formatAtmosphere(atmosphere) {
                    const gasSymbols = {
                        Nitrogen: 'N₂',
                        Oxygen: 'O₂',
                        Argon: 'Ar',
                        CarbonDioxide: 'CO₂',
                        Sodium: 'Na',
                        Helium: 'He',
                        Methane: 'CH₄',
                        Other: 'Other',
                        Hydrogen: 'H₂'
                    };

                 return Object.entries(atmosphere)
                 .map(([gas, percentage]) => `${gasSymbols[gas] || gas} ${percentage}%`)
                 .join(', ');
                 }

                // Function triggered by button clicks to show specific info
                window.showInfo = function(infoType) {
                    if (selectedPlanet) {
                        displayPlanetInfo(selectedPlanet, infoType);
                    } else {
                        alert("No planet selected");
                    }
                };

                // Planet Creation Setups
                function createPlanet() {
                    //originalCameraPosition.copy(camera.position);
                    //originalCameraLookAt.copy(scene.position);
                    let name = document.getElementById("planetName").value;
                    let texture = document.getElementById("textureUploader").files[0];
                    let size = parseFloat(document.getElementById("sizeSlider").value);
                    let rotationPeriod = parseFloat(document.getElementById("rotationPeriodSlider").value);
                    let obliquity = parseFloat(document.getElementById("obliquitySlider").value);
                    let mass = parseFloat(document.getElementById("massSlider").value);
                    let diameter = parseFloat(document.getElementById("diameterSlider").value);
                    let density = parseFloat(document.getElementById("densitySlider").value);
                    let gravity = parseFloat(document.getElementById("gravitySlider").value);
                    let escapeVelocity = parseFloat(document.getElementById("escapeVelocitySlider").value);

                    let moon = parseFloat(document.getElementById("moonSlider").value);
                    let ring = document.getElementById("ringYes").checked;
                    let ringColour = document.getElementById("ringColour").value;
                    let opacity = parseFloat(document.getElementById("opacitySlider").value);
                    let tilt = parseFloat(document.getElementById("tiltSlider").value);

                    let hydrogen = parseFloat(document.getElementById("hydrogenSlider").value);
                    let helium = parseFloat(document.getElementById("heliumSlider").value);
                    let nitrogen = parseFloat(document.getElementById("nitrogenSlider").value);
                    let carbon = parseFloat(document.getElementById("carbonSlider").value);
                    let oxygen = parseFloat(document.getElementById("oxygenSlider").value);
                    let sodium = parseFloat(document.getElementById("sodiumSlider").value);
                    let argon = parseFloat(document.getElementById("argonSlider").value);
                    let methane = parseFloat(document.getElementById("methaneSlider").value);
                    let other = parseFloat(document.getElementById("otherSlider").value);
                    let temp = parseFloat(document.getElementById("tempSlider").value);
                    
                    let orbitRadius = parseFloat(document.getElementById("orbitRadiusSlider").value);
                    let orbitVelocity = parseFloat(document.getElementById("orbitVelocitySlider").value);
                    let orbitInclination = parseFloat(document.getElementById("orbitInclinationSlider").value);
                    let orbitPeriod = parseFloat(document.getElementById("orbitPeriodSlider").value);
                    let eccentricity = parseFloat(document.getElementById("eccentricitySlider").value);

                    let planetGeometry = new THREE.SphereGeometry(size, 32, 32);
                    let planetMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa });
                    let newPlanet = new THREE.Mesh(planetGeometry, planetMaterial);

                    // 设置其他行星属性
                    newPlanet.rotation.y = rotationPeriod * 0.001 * (Math.PI/180);
                    newPlanet.rotation.z = obliquity * (Math.PI/180);
                    newPlanet.position.x = orbitRadius;
                    newPlanet.orbitSpeed = orbitVelocity;
                    newPlanet.orbitAngle = Math.random() * Math.PI * 2
                    scene.add(newPlanet);

                    let orbitGeometry = new THREE.RingGeometry(orbitRadius - 0.01, orbitRadius + 0.01, 64);
                    let orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide });
                    let newOrbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                    newOrbit.rotation.x = orbitInclination * (Math.PI/180);
                    //newPlanet.position.x = orbitRadius * Math.cos(newPlanet.orbitAngle);
                    //newPlanet.position.y = orbitRadius+0.01 * Math.sin(newPlanet.orbitAngle) * Math.cos(newOrbit.rotation.x);
                    //newPlanet.position.z = orbitRadius+0.01 * Math.sin(newPlanet.orbitAngle) * Math.sin(newOrbit.rotation.x);
                    scene.add(newOrbit);

                    const planet = { 
                        name: name, 
                        fresh: true,
                        renderParams: {
                            mesh: newPlanet,
                            orbitMesh: newOrbit,
                            texture: texture, 
                            size: size,
                            rotationPeriod: rotationPeriod,
                            obliquity: obliquity,
                            ring: ring,
                            ringMesh: null,
                            ringColour: ringColour,
                            opacity: opacity,
                            tilt: tilt,
                            orbitRadius: orbitRadius,
                            orbitVelocity: orbitVelocity,
                            orbitInclination: orbitInclination,
                            orbitAngle: Math.random() * Math.PI * 2
                        }, 
                        dataParams: {
                            rotationPeriod: rotationPeriod,
                            obliquity: obliquity,
                            mass: mass,
                            diameter: diameter,
                            density: density,
                            gravity: gravity,
                            escapeVelocity: escapeVelocity,
                            moon: moon,
                            tilt: tilt,
                            temp: temp,
                            orbitPeriod: orbitPeriod,
                            orbitInclination: orbitInclination,
                            eccentricity: eccentricity
                        },
                        atmosphere: {
                            hydrogen: hydrogen,
                            helium: helium,
                            nitrogen: nitrogen,
                            carbon: carbon,
                            oxygen: oxygen,
                            sodium: sodium,
                            argon: argon,
                            methane: methane,
                            other: other,
                        }
                    };
                    planets.push(planet);
                    //selectedPlanet = planet;
                    focusOnPlanet(planet);
                };

                // Sliders Setups
                planetName.addEventListener("change", function() {
                    if (selectedPlanet) {
                        let newName = planetName.value;
                        selectedPlanet.name = newName;
                    }
                });
                textureUploader.addEventListener("change", function(event) {
                    console.log("File input changed");
                    let file = event.target.files[0];
                    if (file) {
                        let reader = new FileReader();
                        reader.onload = function(e) {
                            let image = new Image();
                            image.onload = function() {
                                let texture = new THREE.Texture(image);
                                texture.needsUpdate = true;

                                // 检查 planets 数组是否有元素并应用纹理
                                if (planets.length > 0) {
                                    planets[planets.length - 1].renderParams.mesh.material.map = texture;
                                    planets[planets.length - 1].renderParams.mesh.material.needsUpdate = true;
                                }
                            };
                            image.src = e.target.result; // 将 DataURL 设置为 image 的源
                        };
                        reader.readAsDataURL(file);
                    }
                });

                let sizeSlider = document.getElementById("sizeSlider");
                let sizeValue = document.getElementById("sizeValue");
                let rotationPeriodSlider = document.getElementById("rotationPeriodSlider");
                let rotationPeriodValue = document.getElementById("rotationPeriodValue");     
                let obliquitySlider = document.getElementById("obliquitySlider");
                let obliquityValue = document.getElementById("obliquityValue");
                let massSlider = document.getElementById("massSlider");
                let massValue = document.getElementById("massValue");
                let diameterSlider = document.getElementById("diameterSlider");
                let diameterValue = document.getElementById("diameterValue");    
                let densitySlider = document.getElementById("densitySlider");
                let densityValue = document.getElementById("densityValue");    
                let gravitySlider = document.getElementById("gravitySlider");
                let gravityValue = document.getElementById("gravityValue"); 
                let escapeVelocitySlider = document.getElementById("escapeVelocitySlider");
                let escapeVelocityValue = document.getElementById("escapeVelocityValue");

                let moonSlider = document.getElementById("moonSlider");
                let moonValue = document.getElementById("moonValue");
                let opacitySlider = document.getElementById("opacitySlider");
                let opacityValue = document.getElementById("opacityValue");
                let tiltSlider = document.getElementById("tiltSlider");
                let tiltValue = document.getElementById("tiltValue");

                let hydrogenSlider = document.getElementById("hydrogenSlider");
                let hydrogenValue = document.getElementById("hydrogenValue");
                let heliumSlider = document.getElementById("heliumSlider");
                let heliumValue = document.getElementById("heliumValue");
                let nitrogenSlider = document.getElementById("nitrogenSlider");
                let nitrogenValue = document.getElementById("nitrogenValue");
                let carbonSlider = document.getElementById("carbonSlider");
                let carbonValue = document.getElementById("carbonValue");
                let oxygenSlider = document.getElementById("oxygenSlider");
                let oxygenValue = document.getElementById("oxygenValue");
                let sodiumSlider = document.getElementById("sodiumSlider");
                let sodiumValue = document.getElementById("sodiumValue");
                let argonSlider = document.getElementById("argonSlider");
                let argonValue = document.getElementById("argonValue");
                let methaneSlider = document.getElementById("methaneSlider");
                let methaneValue = document.getElementById("methaneValue");
                let otherSlider = document.getElementById("otherSlider");
                let otherValue = document.getElementById("otherValue");
                let tempSlider = document.getElementById("tempSlider");
                let tempValue = document.getElementById("tempValue");

                let orbitRadiusSlider = document.getElementById("orbitRadiusSlider");
                let orbitRadiusValue = document.getElementById("orbitRadiusValue");
                let orbitVelocitySlider = document.getElementById("orbitVelocitySlider");
                let orbitVelocityValue = document.getElementById("orbitVelocityValue");
                let orbitInclinationSlider = document.getElementById("orbitInclinationSlider");
                let orbitInclinationValue = document.getElementById("orbitInclinationValue");
                let orbitPeriodSlider = document.getElementById("orbitPeriodSlider");
                let orbitPeriodValue = document.getElementById("orbitPeriodValue");
                let eccentricitySlider = document.getElementById("eccentricitySlider");
                let eccentricityValue = document.getElementById("eccentricityValue");
                                                                       
                sizeSlider.addEventListener("input", function() {
                    // Update displayed value
                    sizeValue.textContent = sizeSlider.value;
                    // Update selected planet size
                    if (selectedPlanet) {
                        let newSize = parseFloat(sizeSlider.value);
                        selectedPlanet.renderParams.size = newSize;
                        // Delete current old planet and create new planet with new size
                        selectedPlanet.renderParams.mesh.geometry.dispose();
                        //selectedPlanet.renderParams.mesh.scale.set(newSize, newSize, newSize);
                        selectedPlanet.renderParams.mesh.geometry = new THREE.SphereGeometry(newSize, 32, 32);
                    }
                    if (selectedPlanet.renderParams.ring) {
                        if (selectedPlanet.renderParams.ringMesh) {
                            selectedPlanet.renderParams.mesh.remove(selectedPlanet.renderParams.ringMesh);
                            selectedPlanet.renderParams.ringMesh = null;
                            selectedPlanet.renderParams.ringMesh.geometry.dispose();
                            selectedPlanet.renderParams.ringMesh.material.dispose();
                        }
                            let ringGeometry = new THREE.RingGeometry(1.1*selectedPlanet.renderParams.size, 1.3 * selectedPlanet.renderParams.size, 64);
                            let ringMaterial = new THREE.MeshBasicMaterial({
                                color: new THREE.Color(selectedPlanet.renderParams.ringColour),
                                side: THREE.DoubleSide,
                                transparent: true,
                                opacity:selectedPlanet.renderParams.opacity
                            });
                            let newRing = new THREE.Mesh(ringGeometry, ringMaterial);
                            newRing.rotation.x = selectedPlanet.renderParams.tilt * (Math.PI / 180);

                            // 设置星环的位置为行星的中心
                            newRing.position.set(0, 0, 0); 
                            newRing.rotation.z = Math.random() * Math.PI;
                            selectedPlanet.renderParams.mesh.add(newRing);
                            selectedPlanet.renderParams.ringMesh = newRing;
                    }
                });
                rotationPeriodSlider.addEventListener("input", function() {
                    const minSpeed = 0.0001;
                    const maxSpeed = 0.01;
                    rotationPeriodValue.textContent = rotationPeriodSlider.value;
                    if (selectedPlanet) {
                        let newRotationPeriod = parseFloat(rotationPeriodSlider.value);
                        selectedPlanet.renderParams.rotationPeriod = maxSpeed - (newRotationPeriod/5000) * (maxSpeed-minSpeed);
                        selectedPlanet.dataParams.rotationPeriod = newRotationPeriod;
                    }
                });
                obliquitySlider.addEventListener("input", function() {
                    obliquityValue.textContent = obliquitySlider.value;

                    if (selectedPlanet) {
                        let newObliquity = parseFloat(obliquitySlider.value)* (Math.PI / 180);
                        selectedPlanet.renderParams.obliquity = newObliquity;
                        selectedPlanet.renderParams.mesh.rotation.z = newObliquity;
                        selectedPlanet.dataParams.obliquity = parseFloat(obliquitySlider.value);
                    }
                });
                massSlider.addEventListener("input", function() {
                    massValue.textContent = massSlider.value;
                    if (selectedPlanet) {
                        let newMass = parseFloat(massSlider.value);
                        selectedPlanet.dataParams.mass = newMass;
                    }
                });
                diameterSlider.addEventListener("input", function() {
                    diameterValue.textContent = diameterSlider.value;
                    if (selectedPlanet) {
                        let newDiameter = parseFloat(diameterSlider.value);
                        selectedPlanet.dataParams.diameter = newDiameter;
                    }
                });
                densitySlider.addEventListener("input", function() {
                    densityValue.textContent = densitySlider.value;
                    if (selectedPlanet) {
                        let newDensity = parseFloat(densitySlider.value);
                        selectedPlanet.dataParams.density = newDensity;
                    }
                });
                gravitySlider.addEventListener("input", function() {
                    gravityValue.textContent = gravitySlider.value;
                    if (selectedPlanet) {
                        let newGravity = parseFloat(gravitySlider.value);
                        selectedPlanet.dataParams.gravity = newGravity;
                    }
                });
                escapeVelocitySlider.addEventListener("input", function() {
                    escapeVelocityValue.textContent = escapeVelocitySlider.value;
                    if (selectedPlanet) {
                        let newEscapeVelocity = parseFloat(escapeVelocitySlider.value);
                        selectedPlanet.dataParams.escapeVelocity = newEscapeVelocity;
                    }
                });

                moonSlider.addEventListener("input", function() {
                    moonValue.textContent = moonSlider.value;
                    if (selectedPlanet) {
                        let newMoon = parseFloat(moonSlider.value);
                        selectedPlanet.dataParams.moon = newMoon;
                    }
                });
                document.querySelectorAll("input[name='ringOption']").forEach((radio)=> {
                    radio.addEventListener("change", function(event) {
                        ringYes = event.target.value === "yes";
                        selectedPlanet.renderParams.ring = ringYes;
                        if (selectedPlanet.renderParams.ring) {
                            let ringGeometry = new THREE.RingGeometry(1.1*selectedPlanet.renderParams.size, 1.3 * selectedPlanet.renderParams.size, 64);
                            let ringMaterial = new THREE.MeshBasicMaterial({
                                color: new THREE.Color(selectedPlanet.renderParams.ringColour),
                                side: THREE.DoubleSide,
                                transparent: true,
                                opacity:selectedPlanet.renderParams.opacity
                            });
                            let newRing = new THREE.Mesh(ringGeometry, ringMaterial);
                            newRing.rotation.x = selectedPlanet.renderParams.tilt * (Math.PI / 180);
                            
                            //newRing.position.set(selectedPlanet.renderParams.mesh.position.x, selectedPlanet.renderParams.mesh.position.y, selectedPlanet.renderParams.mesh.position.z);

                            // 设置星环的位置为行星的中心
                            newRing.position.set(0, 0, 0); 
                            newRing.rotation.z = Math.random() * Math.PI;
                            selectedPlanet.renderParams.mesh.add(newRing);
                            selectedPlanet.renderParams.ringMesh = newRing;
                        } else {
                            if (selectedPlanet.renderParams.ringMesh) {
                                selectedPlanet.renderParams.mesh.remove(selectedPlanet.renderParams.ringMesh);
                                                    selectedPlanet.renderParams.ringMesh = null;
                                selectedPlanet.renderParams.ringMesh.geometry.dispose();
                                selectedPlanet.renderParams.ringMesh.material.dispose();
                            }
                        }
                    })
                });
                                         
                ringColour.addEventListener("input", function() {
                    if (selectedPlanet.renderParams.ring) {
                        let newRingColour = ringColour.value;
                        selectedPlanet.renderParams.ringColour = newRingColour;
                        selectedPlanet.renderParams.ringMesh.material.color.set(newRingColour);
                        selectedPlanet.renderParams.ringMesh.material.needsUpdate = true;
                    }
                });
                opacitySlider.addEventListener("input", function() {
                    opacityValue.textContent = opacitySlider.value;
                    if (selectedPlanet.renderParams.ring) {
                        let newOpacity = parseFloat(opacitySlider.value);
                        selectedPlanet.renderParams.opacity = newOpacity;
                        selectedPlanet.renderParams.ringMesh.material.opacity = newOpacity;
                        selectedPlanet.renderParams.ringMesh.material.needsUpdate = true;
                    }
                });
                tiltSlider.addEventListener("input", function() {
                    tiltValue.textContent = tiltSlider.value;
                    if (selectedPlanet.renderParams.ring) {
                        let newTilt = parseFloat(tiltSlider.value) * (Math.PI / 180);
                        selectedPlanet.renderParams.tilt = newTilt;
                        selectedPlanet.renderParams.ringMesh.rotation.x = newTilt;
                        selectedPlanet.dataParams.tilt = parseFloat(tiltSlider.value);
                    }
                });

                hydrogenSlider.addEventListener("input", function() {
                    hydrogenValue.textContent = hydrogenSlider.value;
                    if (selectedPlanet) {
                        let newHydrogen = parseFloat(hydrogenSlider.value);
                        selectedPlanet.atmosphere.hydrogen = newHydrogen;
                    }
                });
                heliumSlider.addEventListener("input", function() {
                    heliumValue.textContent = heliumSlider.value;
                    if (selectedPlanet) {
                        let newHelium = parseFloat(heliumSlider.value);
                        selectedPlanet.atmosphere.helium = newHelium;
                    }
                });
                nitrogenSlider.addEventListener("input", function() {
                    nitrogenValue.textContent = nitrogenSlider.value;
                    if (selectedPlanet) {
                        let newNitrogen = parseFloat(nitrogenSlider.value);
                        selectedPlanet.atmosphere.nitrogen = newNitrogen;
                    }
                });
                carbonSlider.addEventListener("input", function() {
                    carbonValue.textContent = carbonSlider.value;
                    if (selectedPlanet) {
                        let newCarbon = parseFloat(carbonSlider.value);
                        selectedPlanet.atmosphere.carbon = newCarbon;
                    }
                });
                oxygenSlider.addEventListener("input", function() {
                    oxygenValue.textContent = oxygenSlider.value;
                    if (selectedPlanet) {
                        let newOxygen = parseFloat(oxygenSlider.value);
                        selectedPlanet.atmosphere.oxygen = newOxygen;
                    }
                });
                sodiumSlider.addEventListener("input", function() {
                    sodiumValue.textContent = sodiumSlider.value;
                    if (selectedPlanet) {
                        let newSodium = parseFloat(sodiumSlider.value);
                        selectedPlanet.atmosphere.sodium = newSodium;
                    }
                });
                argonSlider.addEventListener("input", function() {
                    argonValue.textContent = argonSlider.value;
                    if (selectedPlanet) {
                        let newArgon = parseFloat(argonSlider.value);
                        selectedPlanet.atmosphere.argon = newArgon;
                    }
                });
                methaneSlider.addEventListener("input", function() {
                    methaneValue.textContent = methaneSlider.value;
                    if (selectedPlanet) {
                        let newMethane = parseFloat(methaneSlider.value);
                        selectedPlanet.atmosphere.methane = newMethane;
                    }
                });
                otherSlider.addEventListener("input", function() {
                    otherValue.textContent = otherSlider.value;
                    if (selectedPlanet) {
                        let newOther = parseFloat(otherSlider.value);
                        selectedPlanet.atmosphere.other = newOther;
                    }
                });
                tempSlider.addEventListener("input", function() {
                    tempValue.textContent = tempSlider.value;
                    if (selectedPlanet) {
                        let newTemp = parseFloat(tempSlider.value);
                        selectedPlanet.dataParams.temp = newTemp;
                    }
                });

                orbitRadiusSlider.addEventListener("input", function() {
                    orbitRadiusValue.textContent = orbitRadiusSlider.value;
                    if (selectedPlanet) {
                        let newOrbitRadius = parseFloat(orbitRadiusSlider.value);
                        selectedPlanet.renderParams.orbitRadius = newOrbitRadius;
                        // Delete current old planet and create new planet with new size
                        selectedPlanet.renderParams.orbitMesh.geometry.dispose();
                        selectedPlanet.renderParams.orbitMesh.geometry = new THREE.RingGeometry(newOrbitRadius - 0.01, newOrbitRadius + 0.01, 64);
                        
                        //selectedPlanet.renderParams.mesh.position.x = selectedPlanet.renderParams.orbitRadius;
                    }
                });
                orbitVelocitySlider.addEventListener("input", function() {
                    orbitVelocityValue.textContent = orbitVelocitySlider.value;
                    if (selectedPlanet) {
                        let newOrbitVelocity = parseFloat(orbitVelocitySlider.value);
                        selectedPlanet.renderParams.orbitVelocity = newOrbitVelocity;
                    }
                });
                orbitInclinationSlider.addEventListener("input", function() {
                    orbitInclinationValue.textContent = orbitInclinationSlider.value;
                    if (selectedPlanet) {
                        let newOrbitInclination = parseFloat(orbitInclinationSlider.value) * (Math.PI / 180);
                        selectedPlanet.renderParams.orbitInclination = newOrbitInclination;
                        selectedPlanet.renderParams.orbitMesh.rotation.x = newOrbitInclination;
                        selectedPlanet.dataParams.orbitInclination = parseFloat(orbitInclinationSlider.value);
                    }
                });
                orbitPeriodSlider.addEventListener("input", function() {
                    orbitPeriodValue.textContent = orbitPeriodSlider.value;
                    if (selectedPlanet) {
                        let newOrbitPeriod = parseFloat(orbitPeriodSlider.value);
                        selectedPlanet.dataParams.orbitPeriod = newOrbitPeriod;
                    }
                });
                eccentricitySlider.addEventListener("input", function() {
                    eccentricityValue.textContent = eccentricitySlider.value;
                    if (selectedPlanet) {
                        let newEccentricity = parseFloat(eccentricitySlider.value);
                        selectedPlanet.dataParams.eccentricity = newEccentricity;
                    }
                });

                // UI Button Setups
                editButton.addEventListener('click', function() {
                    editMode = true;
                    document.getElementById('toolbars').style.display = 'none';
                    document.getElementById('editBars').style.display = 'block';
                });

                displayButton.addEventListener('click', function() {
                    editMode = false;
                    document.getElementById('editBars').style.display = 'none';
                    document.getElementById('toolbars').style.display = 'block';
                });


                planetButton.addEventListener("click", function() {
                    document.getElementById('controls').style.display = 'none';
                    document.getElementById('editTab').style.display = 'block';
                    document.getElementById('menu').style.display = 'block';
                    document.getElementById('editBars').style.display = 'none';
                    document.getElementById('doneButton').style.display = 'block';

                    createPlanet();
                });
                
                doneButton.addEventListener("click", function() {
                    camera.position.copy(originalCameraPosition);
                    camera.lookAt(originalCameraLookAt);

                    planetClickedEnabled = true;
                    selectedPlanet.fresh = false;
                    selectedPlanet = null;
                    resetSliders();
                    
                    document.getElementById('controls').style.display = 'block';
                    document.getElementById('editTab').style.display = 'none';
                    document.getElementById('menu').style.display = 'none';
                    document.getElementById('editBars').style.display = 'block';
                    document.getElementById('doneButton').style.display = 'none';
                });

                // Function triggered by button clicks to show specific info
                window.edit = function(editType) {
                        displayEditPanel(editType);
                };

                // Function to display specific information based on infoType
                window.displayEditPanel =  function(editType) {
                    const panels = document.querySelectorAll(".editPanel");
                    panels.forEach(function(panel) {
                        panel.style.display = "none"; // Hide all first
                    });

                    // Display different information based on the infoType
                    switch (editType) {
                        case 1: // Planet
                            document.getElementById('editPlanet').style.display = 'block';
                            break;
                        case 2: // Ring
                            document.getElementById('editRing').style.display = 'block';
                            break;                    
                        case 3: // Atmosphere
                            document.getElementById('editAtmosphere').style.display = 'block';
                            break;
                        case 4: // Orbit
                            document.getElementById('editOrbit').style.display = 'block';
                            break;
                        default:
                            document.getElementById('editTab').innerText("Select a panel to customize the planet.")
                        }
                }

                function resetSliders() {
                    document.querySelectorAll("input[type='range']").forEach(slider => {
                        slider.value = slider.defaultValue;
                    });
                    document.querySelectorAll("input[type='radio']").forEach(radio => {
                        radio.checked = radio.defaultChecked;
                    });
                    document.getElementById("planetName").value = "";
                    document.getElementById("ringColour").value = "#ffffff";
                    document.getElementById("textureUploader").value = "";

                    sizeValue.textContent = sizeSlider.value;
                    rotationPeriodValue.textContent = rotationPeriodSlider.value;
                    obliquityValue.textContent = obliquitySlider.value;
                    massValue.textContent = massSlider.value;
                    diameterValue.textContent = diameterSlider.value;
                    densityValue.textContent = densitySlider.value;
                    gravityValue.textContent = gravitySlider.value;
                    escapeVelocityValue.textContent = escapeVelocitySlider.value;

                    moonValue.textContent = moonSlider.value;
                    opacityValue.textContent = opacitySlider.value;
                    tiltValue.textContent = tiltSlider.value;

                    hydrogenValue.textContent = hydrogenSlider.value;
                    heliumValue.textContent = heliumSlider.value;
                    nitrogenValue.textContent = nitrogenSlider.value;
                    carbonValue.textContent = carbonSlider.value;
                    oxygenValue.textContent = oxygenSlider.value;
                    sodiumValue.textContent = sodiumSlider.value;
                    argonValue.textContent = argonSlider.value;
                    methaneValue.textContent = methaneSlider.value;
                    otherValue.textContent = otherSlider.value;
                    tempValue.textContent = tempSlider.value;

                    orbitRadiusValue.textContent = orbitRadiusSlider.value;
                    orbitVelocityValue.textContent = orbitVelocitySlider.value;
                    orbitInclinationValue.textContent = orbitInclinationSlider.value;
                    orbitPeriodValue.textContent = orbitPeriodSlider.value;
                    eccentricityValue.textContent = eccentricitySlider.value;
                };

                // 重新编辑指定行星时恢复控件值
                function redoPlanet(selectedPlanet) {
                    if (!selectedPlanet) {
                        console.error('No planet object passed.');
                        return;
                    }
                    document.getElementById("planetName").value = selectedPlanet.name;
                    document.getElementById("sizeSlider").value = selectedPlanet.renderParams.size;
                    document.getElementById("rotationPeriodSlider").value = selectedPlanet.dataParams.rotationPeriod;
                    document.getElementById("obliquitySlider").value = selectedPlanet.dataParams.obliquity;
                    document.getElementById("massSlider").value = selectedPlanet.dataParams.mass;
                    document.getElementById("diameterSlider").value = selectedPlanet.dataParams.diameter;
                    document.getElementById("densitySlider").value = selectedPlanet.dataParams.density;
                    document.getElementById("gravitySlider").value = selectedPlanet.dataParams.gravity;
                    document.getElementById("escapeVelocitySlider").value = selectedPlanet.dataParams.escapeVelocity;

                    document.getElementById("moonSlider").value = selectedPlanet.dataParams.moon;
                    document.getElementById("ringYes").checked = selectedPlanet.renderParams.ring;
                    document.getElementById("ringColour").value = selectedPlanet.renderParams.ringColour;
                    document.getElementById("opacitySlider").value = selectedPlanet.renderParams.opacity;
                    document.getElementById("tiltSlider").value = selectedPlanet.dataParams.tilt;
                    
                    document.getElementById("hydrogenSlider").value = selectedPlanet.atmosphere.hydrogen;
                    document.getElementById("heliumSlider").value = selectedPlanet.atmosphere.helium;
                    document.getElementById("nitrogenSlider").value= selectedPlanet.atmosphere.nitrogen;
                    document.getElementById("carbonSlider").value= selectedPlanet.atmosphere.carbon;
                    document.getElementById("oxygenSlider").value= selectedPlanet.atmosphere.oxygen;
                    document.getElementById("sodiumSlider").value= selectedPlanet.atmosphere.sodium;
                    document.getElementById("argonSlider").value= selectedPlanet.atmosphere.argon;
                    document.getElementById("methaneSlider").value= selectedPlanet.atmosphere.methane;
                    document.getElementById("otherSlider").value= selectedPlanet.atmosphere.other;
                    document.getElementById("tempSlider").value= selectedPlanet.dataParams.temp;

                    document.getElementById("orbitRadiusSlider").value= selectedPlanet.renderParams.orbitRadius;
                    document.getElementById("orbitVelocitySlider").value= selectedPlanet.renderParams.orbitVelocity;
                    document.getElementById("orbitInclinationSlider").value= selectedPlanet.dataParams.orbitInclination;
                    document.getElementById("orbitPeriodSlider").value= selectedPlanet.dataParams.orbitPeriod;
                    document.getElementById("eccentricitySlider").value= selectedPlanet.dataParams.eccentricity;

                    sizeValue.textContent = sizeSlider.value;
                    rotationPeriodValue.textContent = rotationPeriodSlider.value;
                    obliquityValue.textContent = obliquitySlider.value;
                    massValue.textContent = massSlider.value;
                    diameterValue.textContent = diameterSlider.value;
                    densityValue.textContent = densitySlider.value;
                    gravityValue.textContent = gravitySlider.value;
                    escapeVelocityValue.textContent = escapeVelocitySlider.value;

                    moonValue.textContent = moonSlider.value;
                    opacityValue.textContent = opacitySlider.value;
                    tiltValue.textContent = tiltSlider.value;

                    hydrogenValue.textContent = hydrogenSlider.value;
                    heliumValue.textContent = heliumSlider.value;
                    nitrogenValue.textContent = nitrogenSlider.value;
                    carbonValue.textContent = carbonSlider.value;
                    oxygenValue.textContent = oxygenSlider.value;
                    sodiumValue.textContent = sodiumSlider.value;
                    argonValue.textContent = argonSlider.value;
                    methaneValue.textContent = methaneSlider.value;
                    otherValue.textContent = otherSlider.value;
                    tempValue.textContent = tempSlider.value;

                    orbitRadiusValue.textContent = orbitRadiusSlider.value;
                    orbitVelocityValue.textContent = orbitVelocitySlider.value;
                    orbitInclinationValue.textContent = orbitInclinationSlider.value;
                    orbitPeriodValue.textContent = orbitPeriodSlider.value;
                    eccentricityValue.textContent = eccentricitySlider.value;
                };

            
                function animate() {
                    requestAnimationFrame(animate);

                    // 让太阳自转
                    if (sun) sun.rotation.y += 0.001;

                    // //遍历所有行星，更新它们的轨道角度、位置和旋转
                    planets.forEach((planet) => {
                        planet.renderParams.orbitAngle += planet.renderParams.orbitVelocity * 0.00001; // 每个行星的轨道角度

                        // 更新行星的自转
                        planet.renderParams.mesh.rotation.y += planet.renderParams.rotationPeriod;

                        // 更新行星的位置，使其沿轨道运动
                        planet.renderParams.mesh.position.x = (planet.renderParams.orbitRadius-0.01) * Math.cos(planet.renderParams.orbitAngle);
                        planet.renderParams.mesh.position.y = (planet.renderParams.orbitRadius+0.01) * Math.sin(planet.renderParams.orbitAngle) * Math.cos(planet.renderParams.orbitInclination);
                        planet.renderParams.mesh.position.z = (planet.renderParams.orbitRadius+0.01) * Math.sin(planet.renderParams.orbitAngle) * Math.sin(planet.renderParams.orbitInclination);
                        // 跟随行星
                        if (selectedPlanet) {
                            camera.position.lerp(
                                new THREE.Vector3(
                                    selectedPlanet.renderParams.mesh.position.x + 5,
                                    selectedPlanet.renderParams.mesh.position.y + 5,
                                    selectedPlanet.renderParams.mesh.position.z + 5
                                ),
                                0.1 // Speed adjestment factor
                            );
                            camera.lookAt(selectedPlanet.renderParams.mesh.position);
                        }
                    });
                    renderer.render(scene, camera);
                }
                animate();
            };

            window.onload = function() {
            createScene();
            };
        </script>
    </body>
</html>
