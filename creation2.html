<!DOCTYPE html>
<html>
    <head>
        <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #controls { position: absolute; top: 10px; left: 10px; color: white; }
        #toolbars {position: absolute; top: 10px; right: 20px;}
        #editBars {position: absolute; top: 10px; right: 20px; display: none;}
        #doneButton { position: absolute; top: 10px; left: 10px; display: none;}
        #menu button { 
            margin-bottom: 25px; /* 设置按钮间的垂直间距 */
            width: 200px; 
            height: 40px; 
            text-align: left;
            padding-left: 10px;
            font-size: 16px;
            }
        #toolbars button {
            display: inline;
            margin-left: 10px;
            width: 150px;
            height: 20px;
            text-align: center;
            font-size: 10px;
        }
        #editBars button {
            display: inline;
            margin-left: 20px;
            width: 150px;
            height: 20px;
            text-align: center;
            font-size: 10px;
        }
        #editTab {
            position: absolute;
            top: 0;
            right: 0;
            width: 30%; 
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            z-index: 1000;
            color: white;
        }
        .editPanel {
                display: none;
                position: relative;
                top: 0px;
                color: white; 
                height: 100%; 
                width: 100%;
        }
        /* Applies block display and margin to all labels within .editPanel */
        .editPanel label {
            display: block;
            padding-left: 10px;
            margin-bottom: 5px;
            margin-top: 5px;
        }

        /* Keeps labels inside .radio-group inline */
        .radio-group label {
            display: inline;
            margin-right: 10px; /* Adjust spacing between "Yes" and "No" */
        }

        .radio-group {
            display: inline-flex;
            align-items: center;
            margin-bottom: 5px;
        }
        </style>
    </head>
    <body>
        <div id="controls">
            <label>Camera Angle: <input type="range" id="angleSlider" min="0" max="360" value="0"></label><br>
            <label>Zoom: <input type="range" id="zoomSlider" min="10" max="50" value="20"></label>
        </div>
        <div id="toolbars">
            <button id="galaxyButton" onclick="window.location.href='galaxy.html'">Galaxy Showcase</button>
            <button id="editButton">Customize</button>
        </div>
        <div id="editBars">
            <button id="planetButton">Create Planet</button>
            <button id="displayButton">Display</button>
        </div>
        <button id="doneButton">Done</button>
        

        <div id="menu" style="display: none; position: absolute; top: 20%; left: 10px; color: white;">
            <button onclick="edit(1)">Planet</button><br>
            <button onclick="edit(2)">Moon & Ring</button><br>
            <button onclick="edit(3)">Atmosphere</button><br>
            <button onclick="edit(4)">Orbit</button><br>
        </div>
        <div id="editTab">
            <div id="editPlanet" class="editPanel">
                <h3>Planet Appearance</h3>
                <label>Planet Name: <input type="text" id="planetName" placeholder="Enter planet name"></label><br>
                
                <!-- Texture Upload -->
                <label>Upload Planet Texture: <input type="file" id="textureUploader" accept="image/*"></label><br>
        
                <!-- Size Adjustment -->
                <label>Planet Size: 
                    <input type="range" id="sizeSlider" min="0.1" max="5" value="0.5" step="0.1">
                    <span id="sizeValue">0.5</span>
                </label><br>

                <!-- Rotation Period -->
                <label>Rotation Period: 
                    <input type="range" id="rotationPeriodSlider" min="1" max="5000" value="1">
                    <span id="rotationPeriodValue">1</span> hours
                </label><br>
        
                <!-- Obliquity -->
                <label>Obliquity: 
                    <input type="range" id="obliquitySlider" min="0" max="90" value="10">
                    <span id="obliquityValue">10</span>º
                </label><br>
        
                <h3>Physical Properties</h3>            
                <!-- Mass Adjustment -->
                <label>Planet Mass: 
                    <input type="range" id="massSlider" min="0.1" max="2000" value="50">
                    <span id="massValue">50</span> x10²⁴kg
                </label><br>

                <!-- Diameter Adjustment -->
                <label>Planet Diameter: 
                    <input type="range" id="diameterSlider" min="4500" max="150000" value="20000" step="100">
                    <span id="diameterValue">20000</span> km
                </label><br>
        
                <!-- Density Adjustment -->
                <label>Planet Density: 
                    <input type="range" id="densitySlider" min="650" max="5600" value="700">
                    <span id="densityValue">700</span> kg/m³
                </label><br>
        
                <!-- Surface Gravity -->
                <label>Surface Gravity: 
                    <input type="range" id="gravitySlider" min="0" max="100" value="10">
                    <span id="gravityValue">10</span> m/s²
                </label><br>
        
                <!-- Escape Velocity -->
                <label>Escape Velocity: 
                    <input type="range" id="escapeVelocitySlider" min="0" max="100" value="25">
                    <span id="escapeVelocityValue">25</span> km/s
                </label><br>            
            </div>
            <div id="editRing" class="editPanel">
                <h3>Moons</h3>
                <!-- Number of Moons -->
                <label>Number of Moon:
                    <input type="range" id="moonSlider" min="0" max="100" value="1">
                    <span id="moonValue">1</span>
                </label><br>

                <h3>Ring System</h3>
                <label>Add Ring?</label>
                <div class="radio-group">
                    <input type="radio" id="ringYes" name="ringOption" value="yes">
                    <label for="ringYes">Yes</label>
                    <input type="radio" id="ringNo" name="ringOption" value="no" checked>
                    <label for="ringNo">No</label>
                </div>      
            
                <!-- 颜色选择器，默认隐藏 -->
                <div id="colourPicker" style="margin-top: 10px;">
                    <label for="ringColour">Ring Colour:
                    <input type="colour" id="ringColour" value="#ff9900"></label> <!-- 默认颜色 -->
                </div>
                <label>Opacity: 
                    <input type="range" id="opacitySlider" min="0" max="1" value="0.7" step="0.1">
                    <span id="opacityValue">0.7</span>
                </label><br>
                <label>Tilt: 
                    <input type="range" id="tiltSlider" min="0" max="90" value="25">
                    <span id="tiltValue">25</span>º
                </label><br>
            </div>
            <div id="editAtmosphere" class="editPanel">
                <h3>Atmosphere Composition</h3>
                <label>H₂: 
                    <input type="range" id="hydrogenSlider" min="0" max="100" value="0">
                    <span id="hydrogenValue">0</span> %
                </label><br>
                <label>He: 
                    <input type="range" id="heliumSlider" min="0" max="100" value="0">
                    <span id="heliumValue">0</span> %
                </label><br>
                <label>N₂: 
                    <input type="range" id="nitrogenSlider" min="0" max="100" value="0">
                    <span id="nitrogenValue">0</span> %
                </label><br>
                <label>CO₂: 
                    <input type="range" id="carbonSlider" min="0" max="100" value="0">
                    <span id="carbonValue">0</span> %
                </label><br>
                <label>O₂: 
                    <input type="range" id="oxygenSlider" min="0" max="100" value="0">
                    <span id="oxygenValue">0</span> %
                </label><br>
                <label>Na: 
                    <input type="range" id="sodiumSlider" min="0" max="100" value="0">
                    <span id="sodiumValue">0</span> %
                </label><br>
                <label>Ar: 
                    <input type="range" id="argonSlider" min="0" max="100" value="0">
                    <span id="argonValue">0</span> %
                </label><br>
                <label>CH₄: 
                    <input type="range" id="methaneSlider" min="0" max="100" value="0">
                    <span id="methaneValue">0</span> %
                </label><br>
                <label>Other: 
                    <input type="range" id="otherSlider" min="0" max="100" value="0">
                    <span id="otherValue">0</span> %
                </label><br>
            </div>
            <div id="editOrbit" class="editPanel">
                <h3>Orbit Appearance</h3>
                <!-- Orbit Radius -->
                <label>Orbit Radius: 
                    <input type="range" id="orbitRadiusSlider" min="5" max="40" value="10">
                    <span id="orbitRadiusValue">10</span>
                </label><br>
            <!-- Orbit Velocity -->
                <label>Orbit Velocity: 
                    <input type="range" id="orbitVelocitySlider" min="5" max="100" value="25">
                    <span id="orbitVelocityValue">25</span> km/s
                </label><br>
                <!-- Orbit Inclination -->
                <label>Orbit Inclination: 
                    <input type="range" id="orbitInclinationSlider" min="0" max="90" value="90" step="0.5">
                    <span id="orbitInclinationValue">90</span>º            
                </label><br>
                <h3>Orbit Properties</h3>
                <!-- Orbit Eccentricity -->
                <label>Orbit Eccentricity: 
                    <input type="range" id="eccentricitySlider" min="0" max="1" value="0.0156" step="0.0001">
                    <span id="eccentricityValue">0.0156</span>
                </label><br>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
        <script>
            let scene, camera, renderer, sun;
            let selectedPlanet = null;
            const planets = [];
            const orbits = [];
            const orbitAngles = [];
            const orbitRadii = [];
            const planetSizes = [];

            function createScene() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                const textureLoader = new THREE.TextureLoader();
                textureLoader.load('cosmos.jpg', function(texture) {
                    scene.background = texture;
                });

                const sunGeometry = new THREE.SphereGeometry(4, 32, 32);
                textureLoader.load('sun_texture.jpg', function(texture) {
                    const sunMaterial = new THREE.MeshBasicMaterial({ map: texture });
                    sun = new THREE.Mesh(sunGeometry, sunMaterial);
                    scene.add(sun);
                });

                // Camera Setups
                camera.position.set(0, 15, 20);
                camera.lookAt(scene.position);

                let angleSlider = document.getElementById("angleSlider");
                let zoomSlider = document.getElementById("zoomSlider");

                angleSlider.addEventListener("input", updateCamera);
                zoomSlider.addEventListener("input", updateCamera);

                function updateCamera() {
                    let angle = angleSlider.value * Math.PI / 180;
                    let distance = zoomSlider.value;

                    camera.position.x = distance * Math.sin(angle);
                    camera.position.z = distance * Math.cos(angle);
                    camera.lookAt(scene.position);
                };
                

                window.addEventListener('resize', function() {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });

                let originalCameraPosition = camera.position.clone(); // Save original camera position
                let originalCameraLookAt = new THREE.Vector3(0, 0, 0); // Original camera look-at point

                window.focusOnPlanet = function(planetObject) {
                    //if (!planetClickedEnabled) return;
                    
                    //if (!planetObject) {
                        //console.error('No planet object passed.');
                        //return;
                    //}

                    //var planetName = planetObject.name;

                    //console.log("Focusing on planet: " + planetName);

                    selectedPlanet = planetObject;

                    // Save current camera position
                    originalCameraPosition.copy(camera.position);
                    originalCameraLookAt.copy(scene.position);

                    // Adjust camera position, make it focus on the selected planet
                    const offset = 5; // Adjust distance between camera and planet
                    camera.position.set(planetObject.position.x + offset, planetObject.position.y + offset, planetObject.position.z + offset);
                    camera.lookAt(planetObject.position);
                }

                // Planet Creation Setups
                function createPlanet() {
                    originalCameraPosition.copy(camera.position);
                    originalCameraLookAt.copy(scene.position);
                    // Appearance (3D Display)
                    let name = document.getElementById("planetName").value;
                    let texture = document.getElementById("textureUploader").files[0];
                    let size = parseFloat(document.getElementById("sizeSlider").value);
                    let rotationPeriod = parseFloat(document.getElementById("rotationPeriodSlider").value);
                    let obliquity = parseFloat(document.getElementById("obliquitySlider").value);
                    let mass = parseFloat(document.getElementById("massSlider").value);
                    let diameter = parseFloat(document.getElementById("diameterSlider").value);
                    let density = parseFloat(document.getElementById("densitySlider").value);
                    let gravity = parseFloat(document.getElementById("gravitySlider").value);
                    let escapeVelocity = parseFloat(document.getElementById("escapeVelocitySlider").value);

                    let moon = parseFloat(document.getElementById("moonSlider").value);
                    let ring = parseFloat(document.getElementById("ringYes").checked);
                    let ringColour = document.getElementById("ringColour").value;
                    let opacity = parseFloat(document.getElementById("opacitySlider").value);
                    let tilt = parseFloat(document.getElementById("tiltSlider").value);

                    let hydrogen = parseFloat(document.getElementById("hydrogenSlider").value);
                    let helium = parseFloat(document.getElementById("heliumSlider").value);
                    let nitrogen = parseFloat(document.getElementById("nitrogenSlider").value);
                    let carbon = parseFloat(document.getElementById("carbonSlider").value);
                    let oxygen = parseFloat(document.getElementById("oxygenSlider").value);
                    let sodium = parseFloat(document.getElementById("sodiumSlider").value);
                    let argon = parseFloat(document.getElementById("argonSlider").value);
                    let methane = parseFloat(document.getElementById("methaneSlider").value);
                    let other = parseFloat(document.getElementById("otherSlider").value);
                    
                    let orbitRadius = parseFloat(document.getElementById("orbitRadiusSlider").value);
                    let orbitVelocity = parseFloat(document.getElementById("orbitVelocitySlider").value);
                    let orbitInclination = parseFloat(document.getElementById("orbitInclinationSlider").value);
                    let eccentricity = parseFloat(document.getElementById("eccentricitySlider").value);

                    let planetGeometry = new THREE.SphereGeometry(size, 32, 32);
                    let planetMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa });
                    let newPlanet = new THREE.Mesh(planetGeometry, planetMaterial);

                    // 设置其他行星属性
                    newPlanet.rotation.y = rotationPeriod * 0.001 * (Math.PI/180);
                    newPlanet.rotation.z = obliquity * (Math.PI/180);
                    newPlanet.position.x = orbitRadius;
                    newPlanet.orbitSpeed = orbitVelocity;
                    newPlanet.orbitAngle = Math.random() * Math.PI * 2
                    console.log(size)
                    scene.add(newPlanet);

                    if (ring) {
                            let ringGeometry = new THREE.RingGeometry(1.1*size, 1.3 * size, 64);
                            let ringMaterial = new THREE.MeshBasicMaterial({
                                color: new THREE.Color(ringColour),
                                side: THREE.DoubleSide,
                                transparent: true,
                                opacity:opacity
                            });
                            console.log(selectedPlanet.renderParams.ringColour)
                            let newRing = new THREE.Mesh(ringGeometry, ringMaterial);
                            newRing.rotation.x = selectedPlanet.renderParams.tilt * (Math.PI / 180);
                            
                            //newRing.position.set(selectedPlanet.renderParams.mesh.position.x, selectedPlanet.renderParams.mesh.position.y, selectedPlanet.renderParams.mesh.position.z);

                            // 设置星环的位置为行星的中心
                            newRing.position.set(0, 0, 0); 
                            newRing.rotation.z = Math.random() * Math.PI;
                            selectedPlanet.renderParams.mesh.add(newRing);
                            selectedPlanet.renderParams.ringMesh = newRing;
                    }

                    let orbitGeometry = new THREE.RingGeometry(orbitRadius - 0.01, orbitRadius + 0.01, 64);
                    let orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide });
                    let newOrbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                    newOrbit.rotation.x = orbitInclination * (Math.PI/180);
                    //newPlanet.position.x = orbitRadius * Math.cos(newPlanet.orbitAngle);
                    //newPlanet.position.y = orbitRadius+0.01 * Math.sin(newPlanet.orbitAngle) * Math.cos(newOrbit.rotation.x);
                    //newPlanet.position.z = orbitRadius+0.01 * Math.sin(newPlanet.orbitAngle) * Math.sin(newOrbit.rotation.x);
                    scene.add(newOrbit);
                    console.log(orbitInclination)

                    const planet = { 
                        name: name, 
                        renderParams: {
                            mesh: newPlanet,
                            orbitMesh: newOrbit,
                            texture: texture, 
                            size: size,
                            rotationPeriod: rotationPeriod,
                            obliquity: obliquity,
                            ring: ring,
                            ringMesh: null,
                            ringColour: ringColour,
                            opacity: opacity,
                            tilt: tilt,
                            orbitRadius: orbitRadius,
                            orbitVelocity: orbitVelocity,
                            orbitInclination: orbitInclination,
                            orbitAngle: Math.random() * Math.PI * 2
                        }, 
                        dataParams: {
                            mass: mass,
                            diameter: diameter,
                            density: density,
                            gravity: gravity,
                            escapeVelocity: escapeVelocity,
                            moon: moon,
                            hydrogen: hydrogen,
                            helium: helium,
                            nitrogen: nitrogen,
                            carbon: carbon,
                            oxygen: oxygen,
                            sodium: sodium,
                            argon: argon,
                            methane: methane,
                            other: other,
                            eccentricity: eccentricity
                        }
                    };

                    planets.push(planet);
                    selectedPlanet = planet;console.log(planet)
                };

                // Sliders Setups
                planetName.addEventListener("change", function() {
                    if (selectedPlanet) {
                        let newName = planetName.value;
                        selectedPlanet.name = newName;
                    }
                });
                textureUploader.addEventListener("change", function(event) {
                    let file = event.target.files[0];
                    if (file) {
                        let reader = new FileReader();
                        reader.onload = function(e) {
                            let image = new Image();
                            image.onload = function() {
                                let texture = new THREE.Texture(image);
                                texture.needsUpdate = true;

                                // 检查 planets 数组是否有元素并应用纹理
                                if (planets.length > 0) {
                                    planets[planets.length - 1].renderParams.mesh.material.map = texture;
                                    planets[planets.length - 1].renderParams.mesh.material.needsUpdate = true;
                                }
                            };
                            image.src = e.target.result; // 将 DataURL 设置为 image 的源
                        };
                        reader.readAsDataURL(file);
                    }
                });

                let sizeSlider = document.getElementById("sizeSlider");
                let sizeValue = document.getElementById("sizeValue");
                let rotationPeriodSlider = document.getElementById("rotationPeriodSlider");
                let rotationPeriodValue = document.getElementById("rotationPeriodValue");     
                let obliquitySlider = document.getElementById("obliquitySlider");
                let obliquityValue = document.getElementById("obliquityValue");
                let massSlider = document.getElementById("massSlider");
                let massValue = document.getElementById("massValue");
                let diameterSlider = document.getElementById("diameterSlider");
                let diameterValue = document.getElementById("diameterValue");    
                let densitySlider = document.getElementById("densitySlider");
                let densityValue = document.getElementById("densityValue");    
                let gravitySlider = document.getElementById("gravitySlider");
                let gravityValue = document.getElementById("gravityValue"); 
                let escapeVelocitySlider = document.getElementById("escapeVelocitySlider");
                let escapeVelocityValue = document.getElementById("escapeVelocityValue");

                let moonSlider = document.getElementById("moonSlider");
                let moonValue = document.getElementById("moonValue");
                let opacitySlider = document.getElementById("opacitySlider");
                let opacityValue = document.getElementById("opacityValue");
                let tiltSlider = document.getElementById("tiltSlider");
                let tiltValue = document.getElementById("tiltValue");

                let hydrogenSlider = document.getElementById("hydrogenSlider");
                let hydrogenValue = document.getElementById("hydrogenValue");
                let heliumSlider = document.getElementById("heliumSlider");
                let heliumValue = document.getElementById("heliumValue");
                let nitrogenSlider = document.getElementById("nitrogenSlider");
                let nitrogenValue = document.getElementById("nitrogenValue");
                let carbonSlider = document.getElementById("carbonSlider");
                let carbonValue = document.getElementById("carbonValue");
                let oxygenSlider = document.getElementById("oxygenSlider");
                let oxygenValue = document.getElementById("oxygenValue");
                let sodiumSlider = document.getElementById("sodiumSlider");
                let sodiumValue = document.getElementById("sodiumValue");
                let argonSlider = document.getElementById("argonSlider");
                let argonValue = document.getElementById("argonValue");
                let methaneSlider = document.getElementById("methaneSlider");
                let methaneValue = document.getElementById("methaneValue");
                let otherSlider = document.getElementById("otherSlider");
                let otherValue = document.getElementById("otherValue");

                let orbitRadiusSlider = document.getElementById("orbitRadiusSlider");
                let orbitRadiusValue = document.getElementById("orbitRadiusValue");
                let orbitVelocitySlider = document.getElementById("orbitVelocitySlider");
                let orbitVelocityValue = document.getElementById("orbitVelocityValue");
                let orbitInclinationSlider = document.getElementById("orbitInclinationSlider");
                let orbitInclinationValue = document.getElementById("orbitInclinationValue");
                let eccentricitySlider = document.getElementById("eccentricitySlider");
                let eccentricityValue = document.getElementById("eccentricityValue");
                                                                       
                sizeSlider.addEventListener("input", function() {
                    // Update displayed value
                    sizeValue.textContent = sizeSlider.value;
                    // Update selected planet size
                    if (selectedPlanet) {
                        let newSize = parseFloat(sizeSlider.value);
                        selectedPlanet.renderParams.size = newSize;
                        // Delete current old planet and create new planet with new size
                        selectedPlanet.renderParams.mesh.geometry.dispose();
                        selectedPlanet.renderParams.mesh.scale.set(newSize, newSize, newSize);
                    }
                });
                rotationPeriodSlider.addEventListener("input", function() {
                    const minSpeed = 0.0001;
                    const maxSpeed = 0.01;
                    rotationPeriodValue.textContent = rotationPeriodSlider.value;
                    if (selectedPlanet) {
                        let newRotationPeriod = parseFloat(rotationPeriodSlider.value);
                        selectedPlanet.renderParams.rotationPeriod = maxSpeed - (newRotationPeriod/5000) * (maxSpeed-minSpeed);
                    }
                });
                obliquitySlider.addEventListener("input", function() {
                    obliquityValue.textContent = obliquitySlider.value;

                    if (selectedPlanet) {
                        let newObliquity = parseFloat(obliquitySlider.value)* (Math.PI / 180);
                        selectedPlanet.renderParams.obliquity = newObliquity;
                        selectedPlanet.renderParams.mesh.rotation.z = newObliquity;
                    }
                });
                massSlider.addEventListener("input", function() {
                    massValue.textContent = massSlider.value;
                    if (selectedPlanet) {
                        let newMass = parseFloat(massSlider.value);
                        selectedPlanet.dataParams.mass = newMass;
                    }
                });
                diameterSlider.addEventListener("input", function() {
                    diameterValue.textContent = diameterSlider.value;
                    if (selectedPlanet) {
                        let newDiameter = parseFloat(diameterSlider.value);
                        selectedPlanet.dataParams.diameter = newDiameter;
                    }
                });
                densitySlider.addEventListener("input", function() {
                    densityValue.textContent = densitySlider.value;
                    if (selectedPlanet) {
                        let newDensity = parseFloat(densitySlider.value);
                        selectedPlanet.dataParams.density = newDensity;
                    }
                });
                gravitySlider.addEventListener("input", function() {
                    gravityValue.textContent = gravitySlider.value;
                    if (selectedPlanet) {
                        let newGravity = parseFloat(gravitySlider.value);
                        selectedPlanet.dataParams.gravity = newGravity;
                    }
                });
                escapeVelocitySlider.addEventListener("input", function() {
                    escapeVelocityValue.textContent = escapeVelocitySlider.value;
                    if (selectedPlanet) {
                        let newEscapeVelocity = parseFloat(escapeVelocitySlider.value);
                        selectedPlanet.dataParams.escapeVelocity = newEscapeVelocity;
                    }
                });

                moonSlider.addEventListener("input", function() {
                    moonValue.textContent = moonSlider.value;
                    if (selectedPlanet) {
                        let newMoon = parseFloat(moonSlider.value);
                        selectedPlanet.dataParams.moon = newMoon;
                    }
                });
                document.querySelectorAll("input[name='ringOption']").forEach((radio)=> {
                    radio.addEventListener("change", function(event) {
                        ringYes = event.target.value === "yes";
                        selectedPlanet.renderParams.ring = ringYes;
                        if (selectedPlanet.renderParams.ring) {
                            let ringGeometry = new THREE.RingGeometry(1.1*selectedPlanet.renderParams.size, 1.3 * selectedPlanet.renderParams.size, 64);
                            let ringMaterial = new THREE.MeshBasicMaterial({
                                color: new THREE.Color(selectedPlanet.renderParams.ringColour),
                                side: THREE.DoubleSide,
                                transparent: true,
                                opacity:selectedPlanet.renderParams.opacity
                            });
                            console.log(selectedPlanet.renderParams.ringColour)
                            let newRing = new THREE.Mesh(ringGeometry, ringMaterial);
                            newRing.rotation.x = selectedPlanet.renderParams.tilt * (Math.PI / 180);
                            
                            //newRing.position.set(selectedPlanet.renderParams.mesh.position.x, selectedPlanet.renderParams.mesh.position.y, selectedPlanet.renderParams.mesh.position.z);

                            // 设置星环的位置为行星的中心
                            newRing.position.set(0, 0, 0); 
                            newRing.rotation.z = Math.random() * Math.PI;
                            selectedPlanet.renderParams.mesh.add(newRing);
                            selectedPlanet.renderParams.ringMesh = newRing;
                         } else {
                            if (selectedPlanet.renderParams.ringMesh) {
        selectedPlanet.renderParams.mesh.remove(selectedPlanet.renderParams.ringMesh);
                            selectedPlanet.renderParams.ringMesh = null;
        selectedPlanet.renderParams.ringMesh.geometry.dispose();
        selectedPlanet.renderParams.ringMesh.material.dispose();
                            }
                         }
                    })
                });
                                         
                ringColour.addEventListener("input", function() {
                    if (selectedPlanet.renderParams.ring) {
                        let newRingColour = ringColour.value;
                        selectedPlanet.renderParams.ringColour = newRingColour;
                        selectedPlanet.renderParams.ringMesh.material.color.set(newRingColour);
                        selectedPlanet.renderParams.ringMesh.material.needsUpdate = true;
                    }
                });
                opacitySlider.addEventListener("input", function() {
                    opacityValue.textContent = opacitySlider.value;
                    if (selectedPlanet.renderParams.ring) {
                        let newOpacity = parseFloat(opacitySlider.value);
                        selectedPlanet.renderParams.opacity = newOpacity;
                        selectedPlanet.renderParams.ringMesh.material.opacity = newOpacity;
                        selectedPlanet.renderParams.ringMesh.material.needsUpdate = true;
                    }
                });
                tiltSlider.addEventListener("input", function() {
                    tiltValue.textContent = tiltSlider.value;
                    if (selectedPlanet.renderParams.ring) {
                        let newTilt = parseFloat(tiltSlider.value) * (Math.PI / 180);
                        selectedPlanet.renderParams.tilt = newTilt;
                        selectedPlanet.renderParams.ringMesh.rotation.x = newTilt;
                    }
                });

                hydrogenSlider.addEventListener("input", function() {
                    hydrogenValue.textContent = hydrogenSlider.value;
                    if (selectedPlanet) {
                        let newHydrogen = parseFloat(hydrogenSlider.value);
                        selectedPlanet.dataParams.hydrogen = newHydrogen;
                    }
                });
                heliumSlider.addEventListener("input", function() {
                    heliumValue.textContent = heliumSlider.value;
                    if (selectedPlanet) {
                        let newHelium = parseFloat(heliumSlider.value);
                        selectedPlanet.dataParams.helium = newHelium;
                    }
                });
                nitrogenSlider.addEventListener("input", function() {
                    nitrogenValue.textContent = nitrogenSlider.value;
                    if (selectedPlanet) {
                        let newNitrogen = parseFloat(nitrogenSlider.value);
                        selectedPlanet.dataParams.nitrogen = newNitrogen;
                    }
                });
                carbonSlider.addEventListener("input", function() {
                    carbonValue.textContent = carbonSlider.value;
                    if (selectedPlanet) {
                        let newCarbon = parseFloat(carbonSlider.value);
                        selectedPlanet.dataParams.carbon = newCarbon;
                    }
                });
                oxygenSlider.addEventListener("input", function() {
                    oxygenValue.textContent = oxygenSlider.value;
                    if (selectedPlanet) {
                        let newOxygen = parseFloat(oxygenSlider.value);
                        selectedPlanet.dataParams.oxygen = newOxygen;
                    }
                });
                sodiumSlider.addEventListener("input", function() {
                    sodiumValue.textContent = sodiumSlider.value;
                    if (selectedPlanet) {
                        let newSodium = parseFloat(sodiumSlider.value);
                        selectedPlanet.dataParams.sodium = newSodium;
                    }
                });
                argonSlider.addEventListener("input", function() {
                    argonValue.textContent = argonSlider.value;
                    if (selectedPlanet) {
                        let newArgon = parseFloat(argonSlider.value);
                        selectedPlanet.dataParams.argon = newArgon;
                    }
                });
                methaneSlider.addEventListener("input", function() {
                    methaneValue.textContent = methaneSlider.value;
                    if (selectedPlanet) {
                        let newMethane = parseFloat(methaneSlider.value);
                        selectedPlanet.dataParams.methane = newMethane;
                    }
                });
                otherSlider.addEventListener("input", function() {
                    otherValue.textContent = otherSlider.value;
                    if (selectedPlanet) {
                        let newOther = parseFloat(otherSlider.value);
                        selectedPlanet.dataParams.other = newOther;
                    }
                });

                orbitRadiusSlider.addEventListener("input", function() {
                    orbitRadiusValue.textContent = orbitRadiusSlider.value;
                    if (selectedPlanet) {
                        let newOrbitRadius = parseFloat(orbitRadiusSlider.value);
                        selectedPlanet.renderParams.orbitRadius = newOrbitRadius;
                        // Delete current old planet and create new planet with new size
                        selectedPlanet.renderParams.orbitMesh.geometry.dispose();
                        selectedPlanet.renderParams.orbitMesh.geometry = new THREE.RingGeometry(newOrbitRadius - 0.01, newOrbitRadius + 0.01, 64);
                        
                        //selectedPlanet.renderParams.mesh.position.x = selectedPlanet.renderParams.orbitRadius;
                    }
                });
                orbitVelocitySlider.addEventListener("input", function() {
                    orbitVelocityValue.textContent = orbitVelocitySlider.value;
                    if (selectedPlanet) {
                        let newOrbitVelocity = parseFloat(orbitVelocitySlider.value);
                        selectedPlanet.renderParams.orbitVelocity = newOrbitVelocity;
                    }
                });
                orbitInclinationSlider.addEventListener("input", function() {
                    orbitInclinationValue.textContent = orbitInclinationSlider.value;
                    if (selectedPlanet) {
                        let newOrbitInclination = parseFloat(orbitInclinationSlider.value) * (Math.PI / 180);
                        selectedPlanet.renderParams.orbitInclination = newOrbitInclination;
                        selectedPlanet.renderParams.orbitMesh.rotation.x = newOrbitInclination;

                        //selectedPlanet.renderParams.orbitAngle += selectedPlanet.renderParams.orbitVelocity * 0.00001;

                        // Update the planet's self-rotation
                        //selectedPlanet.renderParams.mesh.rotation.y += selectedPlanet.renderParams.rotationPeriod;

                        // Calculate the new position along the inclined orbit
                        //selectedPlanet.renderParams.mesh.position.x = selectedPlanet.renderParams.orbitRadius * Math.cos(selectedPlanet.renderParams.orbitAngle);
                        //selectedPlanet.renderParams.mesh.position.z = selectedPlanet.renderParams.orbitRadius * Math.sin(selectedPlanet.renderParams.orbitAngle);

                        // Apply inclination to the y-axis (to tilt the orbit)
                        //selectedPlanet.renderParams.mesh.position.y = selectedPlanet.renderParams.orbitRadius * Math.sin(newOrbitInclination);  
                    }
                });
                eccentricitySlider.addEventListener("input", function() {
                    eccentricityValue.textContent = eccentricitySlider.value;
                    if (selectedPlanet) {
                        let newEccentricity = parseFloat(eccentricitySlider.value);
                        selectedPlanet.dataParams.eccentricity = newEccentricity;
                    }
                });

                // UI Button Setups
                editButton.addEventListener('click', function() {
                    document.getElementById('toolbars').style.display = 'none';
                    document.getElementById('editBars').style.display = 'block';
                });

                displayButton.addEventListener('click', function() {
                    document.getElementById('editBars').style.display = 'none';
                    document.getElementById('toolbars').style.display = 'block';
                });


                planetButton.addEventListener("click", function() {
                    document.getElementById('controls').style.display = 'none';
                    document.getElementById('editTab').style.display = 'block';
                    document.getElementById('menu').style.display = 'block';
                    document.getElementById('editBars').style.display = 'none';
                    document.getElementById('doneButton').style.display = 'block';

                    createPlanet();
                });
                
                doneButton.addEventListener("click", function() {
                    camera.position.copy(originalCameraPosition);
                    camera.lookAt(originalCameraLookAt);

                    selectedPlanet = null;
                    
                    document.getElementById('controls').style.display = 'block';
                    document.getElementById('editTab').style.display = 'none';
                    document.getElementById('menu').style.display = 'none';
                    document.getElementById('editBars').style.display = 'block';
                    document.getElementById('doneButton').style.display = 'none';
                });

                // Function triggered by button clicks to show specific info
                window.edit = function(editType) {
                        displayEditPanel(editType);
                };

                // Function to display specific information based on infoType
                window.displayEditPanel =  function(editType) {
                    const panels = document.querySelectorAll(".editPanel");
                    panels.forEach(function(panel) {
                        panel.style.display = "none"; // Hide all first
                    });

                    //if (planetData[planetName]) {
                        //const data = planetData[planetName];

                    // Display different information based on the infoType
                    switch (editType) {
                        case 1: // Planet
                            document.getElementById('editPlanet').style.display = 'block';
                            break;
                        case 2: // Ring
                            document.getElementById('editRing').style.display = 'block';
                            break;                    
                        case 3: // Atmosphere
                            document.getElementById('editAtmosphere').style.display = 'block';
                            break;
                        case 4: // Orbit
                            document.getElementById('editOrbit').style.display = 'block';
                            break;
                        default:
                            document.getElementById('editTab').innerText("Select a panel to customize the planet.")
                        }
                }

                // Sliders & Real Time Rendering Setups
                //document.getElementById("textureUploader").addEventListener("change", function(event) {
                    //const file = event.target.files[0];
                    //if (file) {
                        //const reader = new FileReader();
                       // reader.onload = function(e) {
                            //const texture = new THREE.TextureLoader().load(e.target.result);
                            //if (planets.length > 0) {
                              //  planets[planets.length - 1].material.map = texture;
                               // planets[planets.length - 1].material.needsUpdate = true;
                           // }
                        //};
                       // reader.readAsDataURL(file);
                  //  }
                //});

               //  document.getElementById("sizeSlider").addEventListener("input", function() {
                   // planetSize = parseFloat(this.value);
                   // updatePlanet();
              //  });

                //document.getElementById(")

                // document.getElementById("orbitSlider").addEventListener("input", function() {
                //     orbitRadius = parseFloat(this.value);
                //     updatePlanetAndOrbit();
                // });

                function animate() {
                    requestAnimationFrame(animate);

                    // 让太阳自转
                    if (sun) sun.rotation.y += 0.001;

                    // //遍历所有行星，更新它们的轨道角度、位置和旋转
                    planets.forEach((planet) => {
                        planet.renderParams.orbitAngle += planet.renderParams.orbitVelocity * 0.00001; // 每个行星的轨道角度

                        // 更新行星的自转
                        planet.renderParams.mesh.rotation.y += planet.renderParams.rotationPeriod;

                        // 更新行星的位置，使其沿轨道运动
                        planet.renderParams.mesh.position.x = (planet.renderParams.orbitRadius-0.01) * Math.cos(planet.renderParams.orbitAngle);
                        planet.renderParams.mesh.position.y = (planet.renderParams.orbitRadius+0.01) * Math.sin(planet.renderParams.orbitAngle) * Math.cos(planet.renderParams.orbitInclination);
                        planet.renderParams.mesh.position.z = (planet.renderParams.orbitRadius+0.01) * Math.sin(planet.renderParams.orbitAngle) * Math.sin(planet.renderParams.orbitInclination);
                        // 跟随行星
                        if (selectedPlanet) {
                            camera.position.lerp(
                                new THREE.Vector3(
                                    selectedPlanet.renderParams.mesh.position.x + 5,
                                    selectedPlanet.renderParams.mesh.position.y + 5,
                                    selectedPlanet.renderParams.mesh.position.z + 5
                                ),
                                0.1 // Speed adjestment factor
                            );
                            camera.lookAt(selectedPlanet.renderParams.mesh.position);
                        }
                    });
                    renderer.render(scene, camera);
                }
                animate();
            };

            window.onload = function() {
            createScene();
            };
        </script>
    </body>
</html>
