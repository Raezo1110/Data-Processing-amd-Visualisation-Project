<!DOCTYPE html>
<html>
    <head>
        <title>Solar System</title>
        <style>
            body { margin: 0; overflow: hidden; }
            canvas { display: block; }
            #controls { position: absolute; top: 10px; left: 10px; color: white; }
            #topRightButton { position: absolute; top: 10px; right: 20px; color: white; }
            #returnButton { position: absolute; top: 10px; left: 10px; color: white; }
            #menu button { 
            margin-bottom: 25px; /* 设置按钮间的垂直间距 */
            width: 200px; /* Set the desired width */
            height: 40px; /* Set the desired height */
            text-align: left;
            padding-left: 10px;
            font-size: 16px;
            }
            #displayTab {
            position: absolute;
            top: 0;
            right: 0;
            width: 40%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none; /* Initially hidden */
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            z-index: 1000; /* Make sure it appears above other content */
            }
            .buttonContainer {
                display: flex;
                justify-content: space-between;
            }
            .buttonContainer button {
                width: 100px;
                cursor: pointer;
            }
            #chartContainer {
                width: 100%;  /* 设置容器宽度 */
                height: 100%; /* 设置容器高度 */
                position: relative;
            }

            .chart {
                width: 100%;  /* 设置每个图表容器的宽度 */
                height: 100%; /* 设置每个图表容器的高度 */
                display: none; /* 默认隐藏 */
            }
            .lowerSection {
                display: none;
                position: relative;
                top: -10px;
                /* margin-top: 5px;  */
                color: white; 
                height: 68%; 
                width: 100%;
            }
        </style>
    </head>
    <body>
        <div id="controls">
            <!-- Slider for camera angle (rotation around y-axis) -->
        <label>Camera Angle: <input type="range" id="angleSlider" min="0" max="360" value="0"></label><br>
        <!-- Slider for camera zoom (distance from the scene center) -->
        <label>Zoom: <input type="range" id="zoomSlider" min="10" max="50" value="20"></label>
        </div>
        <!-- Button in the top-right corner -->
        <button id="topRightButton">Top Right Button</button>
        <button id="returnButton" style="display: none;">Return</button>
   
        <div id="menu" style="display: none; position: absolute; top: 20%; left: 10px; color: white;">
            <button onclick="showInfo(1)">Basic Physical Properties</button><br>
            <button onclick="showInfo(2)">Gravitational and Dynamic</button><br>
            <button onclick="showInfo(3)">Rotation and Tilt</button><br>
            <button onclick="showInfo(4)">Satellite and Ring System</button><br>
            <button onclick="showInfo(5)">Temperature and Atmospheric</button><br>
            <button onclick="showInfo(6)">Orbit Properties</button><br>
        </div>

        <div id="displayTab">
            <div id="upperSection" style="position: relative; top: -20px; color: white; height: 30%; width: 100%;">Upper Section</div>
            <div id="lower1" class="lowerSection">
                <div id="buttonCon1" class="buttonContainer">
                    <button onclick="chart(1)" class="tabButton">Mass</button>
                    <button onclick="chart(2)" class="tabButton">Diameter</button>
                    <button onclick="chart(3)" class="tabButton">Density</button>
                </div>
                <div id="chartCon1" class="chartContainer">
                    <div id="chart1" class="chart"></div>
                    <div id="chart2" class="chart"></div>
                    <div id="chart3" class="chart"></div>
                </div>
            </div>
            <div id="lower2" class="lowerSection">
                <div id="buttonCon2" class="buttonContainer">
                    <button onclick="chart(4)" class="tabButton">Surface Gravity</button>
                    <button onclick="chart(5)" class="tabButton">Escape Velocity</button>
                </div>
                <div id="chartCon2" class="chartContainer">
                    <div id="chart4" class="chart"></div>
                    <div id="chart5" class="chart"></div>
                </div>
            </div>
            <div id="lower3" class="lowerSection">
                <div id="buttonCon3" class="buttonContainer">
                    <button onclick="chart(6)" class="tabButton">Rotation Period</button>
                    <button onclick="chart(7)" class="tabButton">Obliquity</button>
                </div>
                <div id="chartCon3" class="chartContainer">
                    <div id="chart6" class="chart"></div>
                    <div id="chart7" class="chart"></div>
                </div>
            </div>
            <div id="lower4" class="lowerSection">
                <div id="buttonCon4" class="buttonContainer">
                    <button onclick="chart(8)" class="tabButton">Number of Moons</button>
                    <button onclick="chart(9)" class="tabButton">Ring?</button>
                </div>
                <div id="chartCon4" class="chartContainer">
                    <div id="chart8" class="chart"></div>
                    <div id="chart9" class="chart"></div>
                </div>
            </div>
            <div id="lower5" class="lowerSection">
                <div id="buttonCon5" class="buttonContainer">
                    <button onclick="chart(10)" class="tabButton">Mean Temperature</button>
                    <button onclick="chart(11)" class="tabButton">Atmosphere Composition</button>
                </div>
                <div id="chartCon5" class="chartContainer">
                    <div id="chart10" class="chart"></div>
                    <div id="chart11" class="chart"></div>
                </div>
            </div>
            <div id="lower6" class="lowerSection">
                <div id="buttonCon6" class="buttonContainer">
                    <button onclick="chart(12)" class="tabButton">Period</button>
                    <button onclick="chart(13)" class="tabButton">Velocity</button>
                    <button onclick="chart(14)" class="tabButton">Inclination</button>
                    <button onclick="chart(15)" class="tabButton">Eccentricity</button>
                </div>
                <div id="chartCon6" class="chartContainer">
                    <div id="chart12" class="chart"></div>
                    <div id="chart13" class="chart"></div>
                    <div id="chart14" class="chart"></div>
                    <div id="chart15" class="chart"></div>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script>
            const planetData = {};

            // Function to load CSV data
            function loadCSVData() {
                fetch('planet_system2.csv')
                    .then(response => response.text())
                    .then(data => {
                        // Split rows and parse CSV
                        const rows = data.split('\n');
                        const headers = rows[0].split(',');

                        for (let i = 1; i < rows.length; i++) {
                            const values = rows[i].split(',');
                            const planetName = values[0];
                            planetData[planetName] = {};

                            headers.slice(1).forEach((header, index) => {
                                planetData[planetName][header] = values[index + 1];
                            });
                        }

                        console.log("CSV data loaded:", planetData); // Confirm the data is loaded
                    })
                    .catch(error => console.error('Error loading CSV:', error));
            };

            function initializeScene() {
                scene = new THREE.Scene();
                var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                var renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                // Setup cosmos background
                var textureLoader = new THREE.TextureLoader();
                textureLoader.load('cosmos.jpg', function(texture) {
                    scene.background = texture;
                });

                // Create the Sun
                var sunGeometry = new THREE.SphereGeometry(4, 32, 32);  // Sun's size
                var textureLoader = new THREE.TextureLoader();
                var sun = null;
                textureLoader.load('sun_texture.jpg', function(texture) {
                var sunMaterial = new THREE.MeshBasicMaterial({ map: texture });
                sun = new THREE.Mesh(sunGeometry, sunMaterial);
                scene.add(sun);
                });

                // Planet Texture Upload
                var planets = [];
                var orbitLines = [];
                var planetTextures = [
                    'mercury_texture.jpeg', 'venus_texture.jpeg', 
                    'earth_texture.jpeg', 'mars_texture.jpeg', 
                    'jupiter_texture.jpeg', 'saturn_texture.jpeg', 
                    'uranus_texture.jpeg', 'neptune_texture.jpeg'
                ];

                // Non-Ring Planets
                var planetNamesNoRings = ["Mercury", "Venus", "Earth", "Mars"];
                
                // Ring Planets
                var planetNamesWithRings = ["Jupiter", "Saturn", "Uranus", "Neptune"];

                // Planet Size
                var planetSizes = [
                    0.2, // Mercury
                    0.25,  // Venus
                    0.25,  // Earth
                    0.23, // Mars
                    0.75,  // Jupiter (adjusted up)
                    0.65,  // Saturn
                    0.4, // Uranus
                    0.37  // Neptune
                ];

                // Planet Rings Tilt Angles
                var ringTiltAngles = [
                    0, // Mercury
                    0, // Venus
                    0, // Earth
                    0, // Mars
                    Math.PI / 6, // Jupiter (small tilt)
                    Math.PI / 4, // Saturn (larger tilt for more visibility)
                    Math.PI / 8, // Uranus (vertical rings)
                    Math.PI / 6  // Neptune (small tilt)
                ];

                // Planet Orbit Tilt Angles
                var orbitTiltAngles = [
                    7,  // Mercury
                    3.4, // Venus
                    0, // Earth
                    1.8, // Mars
                    1.3,  // Jupiter
                    2.5,  // Saturn
                    0.8, // Uranus
                    1.8  // Neptune
                ];

                // Create planets without rings (first four)
                planetTextures.slice(0, 4).forEach(function(texture, i) {
                    textureLoader.load(texture, function(planetTexture) {
                        var planetGeometry = new THREE.SphereGeometry(4 * planetSizes[i], 32, 32);
                        var planetMaterial = new THREE.MeshBasicMaterial({ map: planetTexture });
                        var planet = new THREE.Mesh(planetGeometry, planetMaterial);
                        planet.name = planetNamesNoRings[i];
                        planet.orbitRadius = (i + 2) * 2.5;
                        planet.orbitSpeed = 0.002 / planet.orbitRadius;
                        planet.selfRotationSpeed = 0.001 * (i + 1);
                        planet.angle = Math.random() * Math.PI * 2;
                        planets.push(planet);
                        scene.add(planet);

                        var orbitGeometry = new THREE.RingGeometry(planet.orbitRadius - 0.01, planet.orbitRadius + 0.01, 64);
                        var orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide });
                        var orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);

                        // Orbit inclination
                        orbit.rotation.x = Math.PI / 2;
                        orbit.rotation.z = orbitTiltAngles[i];
                        scene.add(orbit);
                        orbitLines.push(orbit);
                    });
                });

                // Create planets with rings (last four)
                planetTextures.slice(4).forEach(function(texture, i) {
                    textureLoader.load(texture, function(planetTexture) {
                        var index = i + 4;
                        var planetGeometry = new THREE.SphereGeometry(4 * planetSizes[index], 32, 32);
                        var planetMaterial = new THREE.MeshBasicMaterial({ map: planetTexture });
                        var planet = new THREE.Mesh(planetGeometry, planetMaterial);
                        planet.name = planetNamesWithRings[i];
                        planet.orbitRadius = (index + 4) * 2.5;
                        if (index === 4) { // Jupiter
                            planet.orbitRadius = 2.5 * 7; // 增加木星的轨道半径
                        }
                        planet.orbitSpeed = 0.002 / planet.orbitRadius;
                        planet.selfRotationSpeed = 0.001 * (index + 1);
                        planet.angle = Math.random() * Math.PI * 2;
                        planets.push(planet);
                        scene.add(planet);

                        // Add ring to planet
                        var ringGeometry = new THREE.RingGeometry(4.5 * planetSizes[index], 5.5 * planetSizes[index], 64);
                        var ringMaterial = new THREE.MeshBasicMaterial({
                            color: 0xf5ece2,
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: index === 4 ? 0.2 : (index === 5 ? 0.5 : 0.2) // Adjust opacity for different rings
                        });
                        var ring = new THREE.Mesh(ringGeometry, ringMaterial);
                        ring.rotation.x = ringTiltAngles[index]; // Use the specific tilt angle for the ring
                        ring.position.set(planet.position.x, planet.position.y, planet.position.z);
                        planet.add(ring);

                        // Set a random rotation for the ring
                        ring.rotation.z = Math.random() * Math.PI; // Random angle for the ring
                        var orbitGeometry = new THREE.RingGeometry(planet.orbitRadius - 0.01, planet.orbitRadius + 0.01, 64);
                        var orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide });
                        var orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                        orbit.rotation.x = Math.PI / 2;
                        orbit.rotation.z = orbitTiltAngles[index];
                        scene.add(orbit);
                        orbitLines.push(orbit);
                    });
                });

                // Create Asteroid Belt between Mars and Jupiter
                var asteroidBelt = [];
                var asteroidCount = 1500; // Number of asteroids
                var minAsteroidRadius = 2.5 * 5.3; // Between Mars and Jupiter
                var maxAsteroidRadius = 2.5 * 5.8; // Adjusted to avoid collision with Jupiter

                for (let i = 0; i < asteroidCount; i++) {
                    var asteroidGeometry = new THREE.SphereGeometry(0.1, 8, 8); // Size of asteroids
                    var asteroidMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa });
                    var asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);

                    // Randomly place asteroid in the belt
                    var orbitRadius = Math.random() * (maxAsteroidRadius - minAsteroidRadius) + minAsteroidRadius;
                    var angle = Math.random() * Math.PI * 2;
                    asteroid.position.x = orbitRadius * Math.cos(angle);
                    asteroid.position.z = orbitRadius * Math.sin(angle);

                    // Add to scene and array
                    scene.add(asteroid);
                    asteroidBelt.push(asteroid);
                }

                // Initial Camera Position
                camera.position.set(0, 15, 20);
                camera.lookAt(scene.position);

                // Camera Position Adjustment Functionality
                var angleSlider = document.getElementById("angleSlider");
                var zoomSlider = document.getElementById("zoomSlider");

                // Listen for the changes in the sliders
                angleSlider.addEventListener("input", updateCamera);
                zoomSlider.addEventListener("input", updateCamera);

                function updateCamera() {
                // Convert angle to radius and set the camera's position
                var angle = angleSlider.value * Math.PI / 180;
                var distance = zoomSlider.value;

                camera.position.x = distance * Math.sin(angle);
                camera.position.z = distance * Math.cos(angle);
                camera.lookAt(scene.position);
                }

                // Handle window resizing
                window.addEventListener('resize', function() {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });

                // Add Raycaster for detecting clicks on planets
                var raycaster = new THREE.Raycaster();
                var mouse = new THREE.Vector2();
                var selectedPlanet = null; // Current selected planet
                var originalCameraPosition = camera.position.clone(); // Save original camera position
                var originalCameraLookAt = new THREE.Vector3(0, 0, 0); // Original camera look-at point

                // Add event listener for mouse clicks
                window.addEventListener('click', onMouseClick, false);

                function onMouseClick(event) {
                    event.preventDefault();
                    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
                    raycaster.setFromCamera(mouse, camera);

                    var intersects = raycaster.intersectObjects(planets);
                    if (intersects.length > 0) {
                        var clickedPlanet = intersects[0].object;
                        focusOnPlanet(clickedPlanet);
                    }
                };

                window.renderMassChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var masses = data.map(function(d) { return parseFloat(d.mass); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: masses,
                            type: 'bar',
                            marker: {color: colors},
                            text: masses.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Mass of Planets (in 10²⁴ kg)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Mass (10²⁴ kg)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart1', [trace], layout);
                    });
                }

                window.renderDiameterChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var diameters = data.map(function(d) { return parseFloat(d.diameter); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: diameters,
                            type: 'bar',
                            marker: {color: colors},
                            text: diameters.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Diameter of Planets (in km)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Diameter (km)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart2', [trace], layout);
                    });
                }

                window.renderDensityChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var densities = data.map(function(d) { return parseFloat(d.density); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: densities,
                            type: 'bar',
                            marker: {color: colors},
                            text: densities.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Density of Planets (in kg/m3)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Density (kg/m3)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart3', [trace], layout);
                    });
                }

                window.renderGravityChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var gravities = data.map(function(d) { return parseFloat(d.surface_gravity); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: gravities,
                            type: 'bar',
                            marker: {color: colors},
                            text: gravities.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Surface Gravity of Planets (in m/s2)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Surface Gravity (m/s2)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart4', [trace], layout);
                    });
                }

                window.renderEscapeVelocityChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var velocities = data.map(function(d) { return parseFloat(d.escape_velocity); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: velocities,
                            type: 'bar',
                            marker: {color: colors},
                            text: velocities.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Escape Velocity of Planets (in km/s)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Escape Velocity (km/s)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart5', [trace], layout);
                    });
                }

                window.renderRotationPeriodChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var rotations = data.map(function(d) { return parseFloat(d.rotation_period); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: rotations,
                            type: 'bar',
                            marker: {color: colors},
                            text: rotations.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Rotation Period of Planets (in hours)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Rotation Period (hours)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart6', [trace], layout);
                    });
                }

                window.renderObliquityChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var obliquities = data.map(function(d) { return parseFloat(d.obliquity); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: obliquities,
                            type: 'bar',
                            marker: {color: colors},
                            text: obliquities.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Obliquity to Orbit of Planets (in degrees)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Obliquity to Orbit (degrees)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart7', [trace], layout);
                    });
                }

                window.renderMoonChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var moons = data.map(function(d) { return parseFloat(d.moon); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: moons,
                            type: 'bar',
                            marker: {color: colors},
                            text: moons.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Number of Moons for Each Planet',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Number of Moons'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart8', [trace], layout);
                    });
                }

                // Need to change, not a bar
                window.renderRingChart = function() {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        // 统计每个环系统状态的数量
                        var ringCounts = {};
                        data.forEach(function(d) {
                            var ringSystem = d.ring === 'yes' ? 'With Ring System' : 'Without Ring System';
                            ringCounts[ringSystem] = (ringCounts[ringSystem] || 0) + 1;
                        });

                        // 转换数据格式以适配饼图绘制
                        var labels = Object.keys(ringCounts);
                        var values = Object.values(ringCounts);

                        var trace = {
                            values: values,
                            labels: labels,
                            type: 'pie',
                            textinfo: 'label+percent',
                            insidetextorientation: 'radial',
                            marker: {
                                colors: ['#FF5733', '#4B8EF1']  // 可根据需要调整颜色
                            }
                        };

                        var layout = {
                            title: 'Planets with Ring Systems',
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: { color: 'white' },
                            width: 550,  
                            height: 420
                        };

                        Plotly.newPlot('chart9', [trace], layout);
                    });
                };


                window.renderTemperatureChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var temperatures = data.map(function(d) { return parseFloat(d.temperature); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: temperatures,
                            type: 'bar',
                            marker: {color: colors},
                            text: temperatures.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Mean Temperature of Planets (C)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Mean Temperature (C)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart10', [trace], layout);
                    });
                }

                // Need to change other csv source
                window.renderAtmosphereChart = function(planetName) {
                    Plotly.d3.csv('planet_atmosphere.csv', function(data) {
                        var planetData = data.find(function(d) { return d.Planet === planetName; });

                        if (!planetData) {
                            alert("No data available for " + planetName);
                            return;
                        }

                        // 提取行星的气体成分数据并移除'Planet'列
                        var gasNames = Object.keys(planetData).filter(function(key) { return key !== 'Planet'; });
                        var gasValues = gasNames.map(function(name) { return parseFloat(planetData[name]); });

                        // 检查气体成分数据是否有效
                        if (gasValues.length === 0) {
                            alert("No atmospheric composition data available for " + planetName);
                            return;
                        }

                        var trace = {
                            values: gasValues,
                            labels: gasNames,
                            type: 'pie',
                            textinfo: 'label+percent',
                            insidetextorientation: 'radial',
                            marker: {
                                colors: ['#FF5733', '#4B8EF1', '#FFC300', '#DAF7A6', '#581845']  // 你可以选择不同的颜色
                            }
                        };

                        var layout = {
                            title: 'Atmospheric Composition of ' + planetName,
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: { color: 'white' },
                            width: 550,  
                            height: 420
                        };

                        Plotly.newPlot('chart11', [trace], layout);
                    });
                };


                window.renderOrbitalPeriodChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var orbitalPeriods = data.map(function(d) { return parseFloat(d.orbital_period); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: orbitalPeriods,
                            type: 'bar',
                            marker: {color: colors},
                            text: orbitalPeriods.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Orbital Period of Planets (in days)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Orbital Period (days)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart12', [trace], layout);
                    });
                }

                window.renderOrbitalVelocityChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var orbitalVelocities = data.map(function(d) { return parseFloat(d.orbital_velocity); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: orbitalVelocities,
                            type: 'bar',
                            marker: {color: colors},
                            text: orbitalVelocities.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Orbital Velocity of Planets (in km/s)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Orbital Velocity (km/s)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart13', [trace], layout);
                    });
                }

                window.renderOrbitalInclinationChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var inclinations = data.map(function(d) { return parseFloat(d.orbital_inclination); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: inclinations,
                            type: 'bar',
                            marker: {color: colors},
                            text: inclinations.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Orbital Inclination of Planets (in degrees)',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Orbital Inclination (degrees)'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart14', [trace], layout);
                    });
                }

                window.renderOrbitalEccentricityChart = function(planetName) {
                    Plotly.d3.csv('planet_system2.csv', function(data) {
                        var planets = data.map(function(d) { return d.Planet; });
                        var eccentricities = data.map(function(d) { return parseFloat(d.eccentricity); });
                        var colors = planets.map(function(name) {
                            return name === planetName ? '#FF5733' : '#4B8EF1';
                        });
                        var trace = {
                            x: planets,
                            y: eccentricities,
                            type: 'bar',
                            marker: {color: colors},
                            text: eccentricities.map(String),
                            textposition: 'outside'
                        };
                        var layout = {
                            title: 'Orbital Eccentricity of Planets',
                            xaxis: {title: 'Planet'},
                            yaxis: {title: 'Eccentricity'},
                            plot_bgcolor: 'rgba(0,0,0,0)',
                            paper_bgcolor: 'rgba(0,0,0,0)',
                            font: {color: 'white'},
                            width: 550,  
                            height: 420
                        };
                    Plotly.newPlot('chart15', [trace], layout);
                    });
                }

                // The toggleChart function now accepts a button number as an argument
                window.toggleChart = function(planetName,chartId) {
                    var charts = document.querySelectorAll(".chart");
                    charts.forEach(function(chart) {
                        chart.style.display = "none"; // Hide all charts first
                    });

                    var chartElement = document.getElementById(chartId);
                    chartElement.style.display = "block";

                    if (chartId === "chart1") {
                        renderMassChart(planetName);
                    } else if (chartId === "chart2") {
                        renderDiameterChart(planetName);
                    } else if (chartId === "chart3") {
                        renderDensityChart(planetName);
                    } else if (chartId === "chart4") {
                        renderGravityChart(planetName);
                    } else if (chartId === "chart5") {
                        renderEscapeVelocityChart(planetName);
                    } else if (chartId === "chart6") {
                        renderRotationPeriodChart(planetName);
                    } else if (chartId === "chart7") {
                        renderObliquityChart(planetName);
                    } else if (chartId === "chart8") {
                        renderMoonChart(planetName);
                    } else if (chartId === "chart9") {
                        renderRingChart(planetName);
                    } else if (chartId === "chart10") {
                        renderTemperatureChart(planetName);
                    } else if (chartId === "chart11") {
                        renderAtmosphereChart(planetName);
                    } else if (chartId === "chart12") {
                        renderOrbitalPeriodChart(planetName);
                    } else if (chartId === "chart13") {
                        renderOrbitalVelocityChart(planetName);
                    } else if (chartId === "chart14") {
                        renderOrbitalInclinationChart(planetName);
                    } else if (chartId === "chart15") {
                        renderOrbitalEccentricityChart(planetName);
                    }
                };

                // Function to display the appropriate chart based on button
                window.displayChart = function(planetName,buttonNumber) {
                    switch (buttonNumber) {
                        case 1:
                            toggleChart(planetName,"chart1");
                            break;
                        case 2:
                            toggleChart(planetName,"chart2");
                            break;
                        case 3:
                            toggleChart(planetName,"chart3");
                            break;
                        case 4:
                            toggleChart(planetName,"chart4");
                            break;
                        case 5:
                            toggleChart(planetName,"chart5");
                            break;
                        case 6:
                            toggleChart(planetName,"chart6");
                            break;
                        case 7:
                            toggleChart(planetName,"chart7");
                            break;
                        case 8:
                            toggleChart(planetName,"chart8");
                            break;
                        case 9:
                            toggleChart(planetName,"chart9");
                            break;
                        case 10:
                            toggleChart(planetName,"chart10");
                            break;
                        case 11:
                            toggleChart(planetName,"chart11");
                            break;
                        case 12:
                            toggleChart(planetName,"chart12");
                            break;
                        case 13:
                            toggleChart(planetName,"chart13");
                            break;
                        case 14:
                            toggleChart(planetName,"chart14");
                            break;
                        case 15:
                            toggleChart(planetName,"chart15");
                            break;
                        default:
                            console.log("Unable to toggle chart");
                    }
                };

                // Function triggered by button clicks to show specific chart
                window.chart = function(chartType) {
                    const planetName = selectedPlanet ? selectedPlanet.name : null; // Ensure there's a selected planet
                    if (planetName) {
                        displayChart(planetName, chartType);
                    } else {
                        alert("No planet selected");
                    }
                };

                // Function triggered by button clicks to show specific info
                window.showInfo = function(infoType) {
                    const planetName = selectedPlanet ? selectedPlanet.name : null; // Ensure there's a selected planet
                    if (planetName) {
                        displayPlanetInfo(planetName, infoType);
                    } else {
                        alert("No planet selected");
                    }
                };

                // Function to display specific information based on infoType
                window.displayPlanetInfo = function(planetName, infoType) {
                    const upperSection = document.getElementById('upperSection');
                    var lowers = document.querySelectorAll(".lowerSection");
                    lowers.forEach(function(lower) {
                        lower.style.display = "none"; // Hide all lower sections first
                    });

                    if (planetData[planetName]) {
                        const data = planetData[planetName];

                        // Display different information based on the infoType
                        switch (infoType) {
                            case 1: // Basic Physical Properties
                                upperSection.innerHTML = `
                                    <h1>${planetName}</h1>
                                    <p>Mass: ${data.mass} x 10²⁴ kg</p>
                                    <p>Diameter: ${data.diameter} km</p>
                                    <p>Density: ${data.density} kg/m³</p>
                                `;
                                document.getElementById('lower1').style.display = 'block';
                                displayChart(planetName,1);
                                break;
                            case 2: // Gravitational and Dynamic Properties
                                upperSection.innerHTML = `
                                    <h1>${planetName}</h1>
                                    <p>Surface Gravity: ${data.surface_gravity} m/s²</p>
                                    <p>Escape Velocity: ${data.escape_velocity} km/s</p>
                                `;
                                document.getElementById('lower2').style.display = 'block';
                                displayChart(planetName,4)
                                break;
                                
                            case 3: // Rotation and Tilt
                                upperSection.innerHTML = `
                                    <h1>${planetName}</h1>
                                    <p>Rotation Period: ${data.rotation_period} hours</p>
                                    <p>Obliquity: ${data.obliquity} º</p>
                                `;
                                document.getElementById('lower3').style.display = 'block';
                                displayChart(planetName,6)
                                break;
                            case 4: // Satellite and Ring System
                                upperSection.innerHTML = `
                                    <h1>${planetName}</h1>
                                    <p>Number of Moons: ${data.moon}</p>
                                    <p>Ring System: ${data.ring}</p>
                                `;
                                document.getElementById('lower4').style.display = 'block';
                                displayChart(planetName,8)
                                break;
                            case 5: // Temperature and Atmospheric Conditions
                                upperSection.innerHTML = `
                                    <h1>${planetName}</h1>
                                    <p>Mean Temperature: ${data.temperature} °C</p>
                                    <p>Atmosphere: ${data.atmosphere}</p>
                                `;
                                document.getElementById('lower5').style.display = 'block';
                                displayChart(planetName,10)
                                break;
                            case 6: // Orbit Properties
                                upperSection.innerHTML = `
                                    <h1>${planetName}</h1>
                                    <p>Orbital Period: ${data.orbital_period} days</p>
                                    <p>Orbital Velocity: ${data.orbital_velocity} km/s</p>
                                    <p>Orbital Inclination: ${data.orbital_inclination} º</p>
                                    <p>Orbital Eccentricity: ${data.eccentricity}</p>
                                `;
                                document.getElementById('lower6').style.display = 'block';
                                displayChart(planetName,12)
                                break;
                            default:
                                upperSection.innerHTML = `<p>No data available for ${planetName}</p>`;
                                lowerSection.innerHTML = '';
                        }
                    } else {
                        upperSection.innerHTML = `<p>No data available for ${planetName}</p>`;
                        lowerSection.innerHTML = '';
                    }
                };

                // Function to handle return button click
                function handleReturnButtonClick() {
                    console.log("Return button clicked"); // 调试输出

                    // 恢复相机位置
                    camera.position.copy(originalCameraPosition);
                    camera.lookAt(originalCameraLookAt);

                    // 清除选中的行星
                    selectedPlanet = null;

                    // 恢复整个星球系统的UI
                    document.getElementById('controls').style.display = 'block';
                    document.getElementById('topRightButton').style.display = 'block';
                    document.getElementById('menu').style.display = 'none';
                    document.getElementById('displayTab').style.display = 'none';
                    document.getElementById('returnButton').style.display = 'none';
                };

                // Function to focus on a specific planet
                window.focusOnPlanet = function(planetObject) {
                    if (!planetObject) {
                        console.error('No planet object passed.');
                        return;
                    }

                    var planetName = planetObject.name;

                    console.log("Focusing on planet: " + planetName);

                    selectedPlanet = planetObject;

                    // Save current camera position
                    originalCameraPosition.copy(camera.position);
                    originalCameraLookAt.copy(scene.position);

                    // Adjust camera position, make it focus on the selected planet
                    var offset = 5; // Adjust distance between camera and planet
                    camera.position.set(planetObject.position.x + offset, planetObject.position.y + offset, planetObject.position.z + offset);
                    camera.lookAt(planetObject.position);

                    // Show the menu and return button
                    document.getElementById('menu').style.display = 'block';
                    document.getElementById('displayTab').style.display = 'block';
                    document.getElementById('returnButton').style.display = 'block';

                    // Hide the camera adjustment functionality and top right button
                    document.getElementById('controls').style.display = 'none';
                    document.getElementById('topRightButton').style.display = 'none';

                    // Update displayed content of upper section
                    if (planetObject.name === "Mercury") {
                        document.getElementById('upperSection').innerHTML = `<h1>${planetObject.name}</h1>
                                                                             <p>Terrestrial Planets</p>`;
                    } else if (planetObject.name === "Venus") {
                        document.getElementById('upperSection').innerHTML = `<h1>${planetObject.name}</h1>
                                                                             <p>Terrestrial Planets</p>`;
                    } else if (planetObject.name === "Earth") {
                        document.getElementById('upperSection').innerHTML = `<h1>${planetObject.name}</h1>
                                                                            <p>Terrestrial Planets</p>`;
                    } else if (planetObject.name === "Mars") {
                        document.getElementById('upperSection').innerHTML = `<h1>${planetObject.name}</h1>
                                                                             <p>Terrestrial Planets</p>`;
                    } else {
                        document.getElementById('upperSection').innerHTML = `<h1>${planetObject.name}</h1>
                                                                             <p>Gas Giants</p>`;
                    }

                    // Display the information about the selected planet (optional)
                    displayPlanetInfo(planetName, 1); // Default to Basic Physical Properties

                    // Only bind the return button click handler once
                    document.getElementById('returnButton').removeEventListener('click', handleReturnButtonClick); // 清除以前的监听
                    document.getElementById('returnButton').addEventListener('click', handleReturnButtonClick);
                }

                // Animation Loop
                var animate = function () {
                requestAnimationFrame(animate);
                planets.forEach(function(planet) {
                    planet.angle += planet.orbitSpeed;
                    planet.position.x = planet.orbitRadius * Math.cos(planet.angle);
                    planet.position.z = planet.orbitRadius * Math.sin(planet.angle);
                    planet.rotation.y += planet.selfRotationSpeed;
                });

                // Update asteroids (optional: add movement)
                asteroidBelt.forEach(function(asteroid) {
                    // Example: Rotate the asteroid slightly for effect
                    asteroid.rotation.y += 0.01;
                });

                if (sun) {
                sun.rotation.y += 0.001;
                }

                // Camera contiuously trace the selected planet
                if (selectedPlanet) {
                    camera.position.lerp(
                        new THREE.Vector3(
                            selectedPlanet.position.x + 5,
                            selectedPlanet.position.y + 5,
                            selectedPlanet.position.z + 5
                    ),
                    0.1 // Speed adjestment factor
                );
                camera.lookAt(selectedPlanet.position);
                }
                    renderer.render(scene, camera);
                };
                animate();
            };

            window.onload = function() {
                loadCSVData();
                initializeScene();
            };
        </script>
    </body>
</html>
