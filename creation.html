<!DOCTYPE html>
<html>
<head>
    <title>Planets Creation</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #controls { position: absolute; top: 10px; left: 10px; color: white; }
        #galaxyButton { position: absolute; top: 10px; right: 20px; color: white; }
        #planetButton { position: absolute; margin-top: 10px; top: 30px; right: 20px; color: white; }
        #creationTab {
            position: absolute;
            top: 0;
            right: 0;
            width: 45%; 
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            z-index: 1000;
            color: white;
        }
    </style>
</head>
<body>
    <div id="controls">
        <label>Camera Angle: <input type="range" id="angleSlider" min="0" max="360" value="0"></label><br>
        <label>Zoom: <input type="range" id="zoomSlider" min="10" max="50" value="20"></label>
    </div>
    <button id="galaxyButton" onclick="window.location.href='galaxy.html'">Galaxy Showcase</button>
    <button id="planetButton">Create Planet</button>

    <div id="creationTab">
        <label>Planet Size: <input type="range" id="sizeSlider" min="1" max="5" value="2"></label><br>
        <label>Orbit Radius: <input type="range" id="orbitSlider" min="10" max="30" value="15"></label><br>
        <label>Upload Planet Texture: <input type="file" id="textureUploader" accept="image/*"></label>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
    <script>
        let scene, camera, renderer, sun;
        let planet, orbit;
        let planetSize = 2;
        let orbitRadius = 15;
        let planetTexture = null;

        function createScene() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const textureLoader = new THREE.TextureLoader();
            textureLoader.load('cosmos.jpg', function(texture) {
                scene.background = texture;
            });

            const sunGeometry = new THREE.SphereGeometry(4, 32, 32);
            textureLoader.load('sun_texture.jpg', function(texture) {
                const sunMaterial = new THREE.MeshBasicMaterial({ map: texture });
                sun = new THREE.Mesh(sunGeometry, sunMaterial);
                scene.add(sun);
            });

            camera.position.set(0, 15, 20);
            camera.lookAt(scene.position);

            var angleSlider = document.getElementById("angleSlider");
            var zoomSlider = document.getElementById("zoomSlider");

            angleSlider.addEventListener("input", updateCamera);
            zoomSlider.addEventListener("input", updateCamera);

            function updateCamera() {
                var angle = angleSlider.value * Math.PI / 180;
                var distance = zoomSlider.value;

                camera.position.x = distance * Math.sin(angle);
                camera.position.z = distance * Math.cos(angle);
                camera.lookAt(scene.position);
            }

            window.addEventListener('resize', function() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            planetButton.addEventListener('click', function() {
                document.getElementById('galaxyButton').style.display = 'none';
                document.getElementById('planetButton').style.display = 'none';
                document.getElementById('creationTab').style.display = 'block';
                
                createPlanetAndOrbit();
                //focusOnPlanet();
            });

            document.getElementById("sizeSlider").addEventListener("input", function() {
                planetSize = parseFloat(this.value);
                updatePlanetAndOrbit();
            });

            document.getElementById("orbitSlider").addEventListener("input", function() {
                orbitRadius = parseFloat(this.value);
                updatePlanetAndOrbit();
            });

            function animate() {
                requestAnimationFrame(animate);
                if (sun) sun.rotation.y += 0.001;

                if (planet) {
                    // 让行星沿轨道旋转
                    planet.rotation.y += 0.01;
                    planet.position.x = orbitRadius * Math.cos(planet.rotation.y);
                    planet.position.z = orbitRadius * Math.sin(planet.rotation.y);

                    // 更新相机的位置，使其相对于行星保持一个固定偏移量
                    const cameraOffset = 10; // 相机与行星的距离
                    camera.position.x = planet.position.x + cameraOffset;
                    camera.position.y = planet.position.y + 5; // 可以调节以实现不同的视角高度
                    camera.position.z = planet.position.z + cameraOffset;

                    // 相机始终面向行星
                    camera.lookAt(planet.position);
                }
                    renderer.render(scene, camera);
                }
                animate();
        }

        function createPlanetAndOrbit() {
            const planetGeometry = new THREE.SphereGeometry(planetSize, 32, 32);
            const planetMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa, map: planetTexture});
            planet = new THREE.Mesh(planetGeometry, planetMaterial);
            planet.position.x = orbitRadius;
            scene.add(planet);

            const orbitGeometry = new THREE.RingGeometry(orbitRadius-0.5, orbitRadius+0.5, 64);
            const orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide });
            orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
            orbit.rotation.x = Math.PI / 2;
            scene.add(orbit);
        }

        function updatePlanetAndOrbit() {
            if (planet) {
                scene.remove(planet);
            }
            if (orbit) {
                scene.remove(orbit);
            }
            createPlanetAndOrbit();
            //focusOnPlanet();
        }

        document.getElementById("textureUploader").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    planetTexture = new THREE.TextureLoader().load(e.target.result);
                    if (planet) {
                        planet.material.map = texture;
                        planet.material.needsUpdate = true;
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        window.onload = function() {
            createScene();
        };
    </script>
</body>
</html>
